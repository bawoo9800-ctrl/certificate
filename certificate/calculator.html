<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방화문 단가 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Pretendard 폰트 (다나와 스타일) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
      :root {
        --primary-blue: #2563eb;
        --primary-blue-dark: #1e40af;
        --primary-blue-light: #3b82f6;
        --secondary-gray: #f8fafc;
        --border-gray: #e2e8f0;
        --text-dark: #1e293b;
        --text-gray: #64748b;
      }
      
      body {
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }
      
      /* 카드 스타일 */
      .card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
      }
      
      .card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      
      /* 섹션 헤더 - 컴팩트 */
      .section-header {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        margin-bottom: 12px;
        font-weight: 600;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      
      /* 입력 필드 스타일 - 컴팩트 */
      .input-group {
        background: var(--secondary-gray);
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 10px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }
      
      .input-group:hover {
        border-color: var(--border-gray);
        background: white;
      }
      
      /* 메인 입력 섹션 간격 */
      .main-input-section {
        margin-bottom: 16px;
      }
      
      .input-label {
        color: var(--text-dark);
        font-weight: 600;
        font-size: 0.75rem;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      
      .input-field {
        width: 100%;
        padding: 6px 10px;
        border: 2px solid var(--border-gray);
        border-radius: 6px;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        background: white;
      }
      
      .input-field:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }
      
      /* 라디오/체크박스 스타일 - 컴팩트 */
      .option-card {
        background: white;
        border: 2px solid var(--border-gray);
        border-radius: 6px;
        padding: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
      }
      
      .option-card:hover {
        border-color: var(--primary-blue-light);
        background: #eff6ff;
      }
      
      .peer:checked ~ .option-card {
        border-color: var(--primary-blue);
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
        transform: scale(1.02);
      }
      
      .option-card.active {
        border-color: var(--primary-blue);
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
      }
      
      /* 초기화 버튼 스타일 */
      .reset-btn {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 6px 12px;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      }
      
      .reset-btn:hover {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        box-shadow: 0 4px 6px rgba(239, 68, 68, 0.4);
        transform: translateY(-1px);
      }
      
      .reset-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
      }
      
      /* 철판막음 모달 스타일 */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: flex-start;
        justify-content: center;
        z-index: 9999;
        overflow-y: auto;
        padding: 20px;
      }
      
      .modal-container {
        background: white;
        border-radius: 16px;
        width: 100%;
        max-width: 700px;
        max-height: 90vh;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        animation: modalSlideDown 0.3s ease-out;
      }
      
      @keyframes modalSlideDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .modal-header {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        color: white;
        padding: 16px 20px;
        border-radius: 16px 16px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      }
      
      .modal-title {
        font-size: 1.25rem;
        font-weight: 700;
        display: flex;
        align-items: center;
      }
      
      .modal-close-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }
      
      .modal-close-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
      }
      
      .modal-footer {
        background: #f8fafc;
        padding: 16px 20px;
        border-radius: 0 0 16px 16px;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        flex-shrink: 0;
        border-top: 1px solid var(--border-gray);
      }
      
      .modal-btn-primary {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3);
      }
      
      .modal-btn-primary:hover {
        box-shadow: 0 4px 6px rgba(37, 99, 235, 0.4);
        transform: translateY(-2px);
      }
      
      .modal-btn-secondary {
        background: white;
        color: var(--text-gray);
        border: 2px solid var(--border-gray);
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .modal-btn-secondary:hover {
        border-color: var(--primary-blue);
        color: var(--primary-blue);
        background: #eff6ff;
      }
      
      .steel-plate-item {
        background: white;
        border: 2px solid var(--border-gray);
        border-radius: 12px;
        padding: 16px;
        transition: all 0.3s ease;
      }
      
      .steel-plate-item:hover {
        border-color: var(--primary-blue-light);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }
      
      .modal-radio-option {
        cursor: pointer;
        display: block;
      }
      
      .modal-radio-card {
        background: white;
        border: 2px solid var(--border-gray);
        border-radius: 8px;
        padding: 12px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s ease;
      }
      
      .modal-radio-card:hover {
        border-color: var(--primary-blue-light);
        background: #eff6ff;
      }
      
      .peer:checked ~ .modal-radio-card {
        border-color: var(--primary-blue);
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
      }
      
      .modal-radio-card.active {
        border-color: var(--primary-blue);
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
      }
      
      /* 견적 결과 카드 - 컴팩트 */
      .result-card {
        background: white;
        border-radius: 12px;
        padding: 12px;
        min-height: 400px;
        position: sticky;
        top: 10px;
      }
      
      .result-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: white;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 12px;
        text-align: center;
      }
      
      .result-header h3 {
        font-size: 0.9rem;
        font-weight: 700;
        margin-bottom: 2px;
      }
      
      .result-header .subtitle {
        font-size: 0.7rem;
        opacity: 0.8;
      }
      
      .price-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 10px;
        background: white;
        border-bottom: 1px solid #e5e7eb;
        margin-bottom: 0;
        font-size: 0.75rem;
      }
      
      .price-item:last-child {
        border-bottom: none;
      }
      
      .price-item.total {
        background: white;
        font-weight: 700;
        font-size: 0.9rem;
        padding: 12px 10px;
        margin-top: 8px;
        border-top: 2px solid #e5e7eb;
        border-bottom: none;
      }
      
      .price-item.grand-total {
        background: white;
        font-weight: 700;
        font-size: 1.1rem;
        padding: 12px 10px;
        margin-top: 4px;
        border-top: 2px solid #2563eb;
        border-bottom: none;
      }
      
      .price-label {
        color: #6b7280;
        font-weight: 400;
      }
      
      .price-label.total-label {
        color: #374151;
        font-weight: 600;
      }
      
      .price-label.grand-total-label {
        color: #2563eb;
        font-weight: 700;
      }
      
      .price-value {
        color: #374151;
        font-weight: 600;
        font-size: 0.85rem;
        text-align: right;
      }
      
      .price-value.total-value {
        color: #374151;
        font-weight: 700;
        font-size: 1rem;
      }
      
      .price-value.grand-total-value {
        color: #2563eb;
        font-weight: 700;
        font-size: 1.3rem;
      }
      
      .price-value.discount {
        color: #ef4444;
      }
      
      /* 버튼 스타일 - 컴팩트 */
      .btn-primary {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.8rem;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.4);
      }
      
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4);
      }
      
      .btn-secondary {
        background: white;
        color: var(--primary-blue);
        border: 2px solid var(--primary-blue);
        padding: 6px 14px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .btn-secondary:hover {
        background: var(--primary-blue);
        color: white;
      }
      
      /* 숫자 입력 필드의 증감 버튼(spinner) 제거 */
      input[type=number]::-webkit-inner-spin-button,
      input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type=number] {
        -moz-appearance: textfield;
        appearance: textfield;
      }
      
      /* 애니메이션 */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .fade-in {
        animation: fadeIn 0.5s ease-out;
      }
      
      /* 헤더 스타일 - 컴팩트 */
      .main-header {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        padding: 12px 20px;
        margin-bottom: 12px;
      }
      
      .main-header h1 {
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--text-dark);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .main-header .header-icon {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.1rem;
      }
      
      /* 커스텀 체크박스 스타일 - 컴팩트 */
      .custom-checkbox {
        position: relative;
        cursor: pointer;
        user-select: none;
      }
      
      .custom-checkbox input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }
      
      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border: 1.5px solid var(--border-gray);
        border-radius: 6px;
        background: white;
        transition: all 0.3s ease;
        font-size: 0.7rem;
        font-weight: 600;
      }
      
      .checkbox-label:hover {
        border-color: var(--primary-blue-light);
        background: #eff6ff;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
      }
      
      .custom-checkbox input[type="checkbox"]:checked ~ .checkbox-label {
        border-color: var(--primary-blue);
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
      }
      
      .checkbox-icon {
        width: 14px;
        height: 14px;
        border: 1.5px solid var(--border-gray);
        border-radius: 3px;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        flex-shrink: 0;
      }
      
      .custom-checkbox input[type="checkbox"]:checked ~ .checkbox-label .checkbox-icon {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
      }
      
      .checkbox-icon::after {
        content: "✓";
        color: white;
        font-size: 10px;
        font-weight: bold;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s ease;
      }
      
      .custom-checkbox input[type="checkbox"]:checked ~ .checkbox-label .checkbox-icon::after {
        opacity: 1;
        transform: scale(1);
      }
      
      /* 하드웨어 탭 스타일 */
      .hardware-tab {
        position: relative;
        transition: all 0.3s ease;
      }
      
      .hardware-tab.active {
        border-bottom-color: #eab308 !important;
        background-color: #fef9c3 !important;
        color: #854d0e !important;
      }
      
      .hardware-tab:not(.active):hover {
        background-color: #fef9c3;
        border-bottom-color: #fbbf24;
      }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-3 max-w-[1800px]">
        <!-- 헤더 -->
        <div class="main-header">
            <div class="flex justify-between items-center">
                <h1>
                    <div class="header-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    방화문 단가 계산기
                </h1>
                <div class="flex gap-2 items-center">
                    <!-- 로그인 사용자 정보 -->
                    <div id="userInfo" class="flex items-center gap-2 px-3 py-1 bg-blue-50 rounded-lg">
                        <i class="fas fa-user text-blue-600"></i>
                        <span id="userName" class="text-sm font-medium text-gray-700"></span>
                        <button onclick="logout()" class="text-xs text-red-600 hover:text-red-700 ml-2">
                            <i class="fas fa-sign-out-alt"></i> 로그아웃
                        </button>
                    </div>
                    <button onclick="openQuotationListModal()" class="btn-secondary flex items-center gap-2">
                        <i class="fas fa-folder-open"></i>
                        <span>견적서 목록</span>
                    </button>
                    <!-- 관리자 전용 버튼 -->
                    <a id="settingsBtn" href="/settings.html" class="btn-secondary flex items-center gap-2" style="display: none;">
                        <i class="fas fa-cog"></i>
                        <span>설정</span>
                    </a>
                    <a id="userManagementBtn" href="/user-management.html" class="btn-secondary flex items-center gap-2" style="display: none;">
                        <i class="fas fa-users-cog"></i>
                        <span>사용자 관리</span>
                    </a>
                    <a id="settingsBtn" href="/settings.html" class="btn-secondary flex items-center gap-2" style="display: none;">
                        <i class="fas fa-cog"></i>
                        <span>설정</span>
                    </a>
                    <a href="https://p.doorlife.synology.me/admin-prices.html" class="btn-primary flex items-center gap-2">
                        <i class="fas fa-table"></i>
                        <span>가격표 관리</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- 메인 그리드: 3열 (입력폼 2.5/4 | 문틀견적 0.75/4 | 문짝견적 0.75/4) -->
        <div class="grid gap-4" style="grid-template-columns: 2.5fr 0.75fr 0.75fr;">
            <!-- 왼쪽: 계산 폼 -->
            <div class="card" style="padding: 12px;">
                <form id="calculatorForm">
                <!-- 단가 유형 선택 -->
                <div class="section-header flex justify-between items-center">
                    <div>
                        <i class="fas fa-tag"></i>
                        <span>단가 유형 선택</span>
                    </div>
                    <button type="button" id="resetBtn" class="reset-btn" onclick="resetCalculator()">
                        <i class="fas fa-redo-alt mr-1"></i>
                        초기화
                    </button>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    <label class="relative cursor-pointer">
                        <input type="radio" name="priceType" value="general" class="peer hidden" checked>
                        <div class="option-card peer-checked:active">
                            <i class="fas fa-user text-lg mb-1" style="color: var(--primary-blue);"></i>
                            <div class="font-semibold text-xs">일반 단가</div>
                        </div>
                    </label>
                    <label class="relative cursor-pointer">
                        <input type="radio" name="priceType" value="dealer" class="peer hidden">
                        <div class="option-card peer-checked:active">
                            <i class="fas fa-store text-lg mb-1" style="color: var(--primary-blue);"></i>
                            <div class="font-semibold text-xs">대리점 단가</div>
                        </div>
                    </label>
                    <label class="relative cursor-pointer">
                        <input type="radio" name="priceType" value="pntech" class="peer hidden">
                        <div class="option-card peer-checked:active">
                            <i class="fas fa-building text-lg mb-1" style="color: var(--primary-blue);"></i>
                            <div class="font-semibold text-xs">피엔텍</div>
                        </div>
                    </label>
                    <label class="relative cursor-pointer">
                        <input type="radio" name="priceType" value="hanatech" class="peer hidden">
                        <div class="option-card peer-checked:active">
                            <i class="fas fa-industry text-lg mb-1" style="color: var(--primary-blue);"></i>
                            <div class="font-semibold text-xs">하나테크</div>
                        </div>
                    </label>
                </div>

                <!-- 방화문 타입 선택 -->
                <div class="section-header">
                    <i class="fas fa-fire-extinguisher"></i>
                    <span>방화문 타입</span>
                </div>
                <div class="input-group">
                    <div class="grid grid-cols-7 gap-1.5">
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="sd" class="peer hidden" checked>
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-door-closed text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">SD</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="sd-insulated" class="peer hidden">
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-door-closed text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">SD단열</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="sd-insulated-eu" class="peer hidden">
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-door-closed text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">SD단열[유럽형]</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="panel-1.2t" class="peer hidden">
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-layer-group text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">판넬용1.2T후렘</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="fsd" class="peer hidden">
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-door-open text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">FSD</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="certified" class="peer hidden">
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-certificate text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">인정제품</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="fireDoorType" value="pig-barn" class="peer hidden">
                            <div class="border border-gray-300 rounded p-1 text-center hover:border-red-500 peer-checked:border-red-600 peer-checked:bg-red-50 transition">
                                <i class="fas fa-warehouse text-sm text-red-600"></i>
                                <div class="font-semibold text-[10px]">돈사도어</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 판넬용1.2T후렘 두께 선택 (조건부 표시) -->
                <div id="panelThicknessSelector" class="mb-4 hidden">
                    <label class="block text-gray-700 font-semibold mb-2 text-base">
                        <i class="fas fa-ruler-vertical mr-2 text-blue-600"></i>판넬용1.2T후렘 두께
                    </label>
                    <div class="grid grid-cols-6 gap-2">
                        <label class="relative cursor-pointer">
                            <input type="radio" name="panelThickness" value="50" class="peer hidden" checked>
                            <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                <div class="font-semibold text-sm">50T</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="panelThickness" value="75" class="peer hidden">
                            <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                <div class="font-semibold text-sm">75T</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="panelThickness" value="100" class="peer hidden">
                            <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                <div class="font-semibold text-sm">100T</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="panelThickness" value="125" class="peer hidden">
                            <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                <div class="font-semibold text-sm">125T</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="panelThickness" value="150" class="peer hidden">
                            <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                <div class="font-semibold text-sm">150T</div>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="panelThickness" value="155" class="peer hidden">
                            <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                <div class="font-semibold text-sm">155T</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- 문틀 입력 -->
                    <div id="frameSection" class="border-2 border-indigo-200 rounded-xl p-4 bg-indigo-50 transition-all">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg font-bold text-gray-800">
                                <i class="fas fa-border-style mr-2 text-indigo-600"></i>문틀 (Frame)
                            </h3>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="frameEnableCheckbox" checked onchange="toggleFrameSection()" class="w-4 h-4 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500">
                                <span class="text-sm font-semibold text-gray-700">사용</span>
                            </label>
                        </div>
                        <div class="space-y-3">
                            <!-- 후렘두께 타입 / 문짝 타입 - 컴팩트 버튼 스타일 -->
                            <div class="grid grid-cols-2 gap-3">
                                <!-- 후렘두께 타입 -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1.5">
                                        <i class="fas fa-ruler-horizontal text-indigo-600 mr-1"></i>후렘두께 타입
                                    </label>
                                    <div class="grid grid-cols-2 gap-1.5">
                                        <label class="relative cursor-pointer">
                                            <input type="radio" name="thicknessType" value="bar" class="peer hidden" checked>
                                            <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                        peer-checked:border-indigo-600 peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:shadow-md
                                                        hover:border-indigo-400">
                                                <div class="font-bold text-sm">조적(바)</div>
                                            </div>
                                        </label>
                                        <label class="relative cursor-pointer">
                                            <input type="radio" name="thicknessType" value="t" class="peer hidden">
                                            <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                        peer-checked:border-indigo-600 peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:shadow-md
                                                        hover:border-indigo-400">
                                                <div class="font-bold text-sm">판넬(T)</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- 문짝 타입 -->
                                <div>
                                    <label class="block text-xs font-bold text-gray-700 mb-1.5">
                                        <i class="fas fa-door-open text-indigo-600 mr-1"></i>문짝 타입
                                    </label>
                                    <div class="grid grid-cols-2 gap-1.5">
                                        <label class="relative cursor-pointer">
                                            <input type="radio" name="doorType" value="single" class="peer hidden" checked>
                                            <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                        peer-checked:border-indigo-600 peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:shadow-md
                                                        hover:border-indigo-400">
                                                <div class="font-bold text-sm">편개</div>
                                            </div>
                                        </label>
                                        <label class="relative cursor-pointer">
                                            <input type="radio" name="doorType" value="double" class="peer hidden">
                                            <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                        peer-checked:border-indigo-600 peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:shadow-md
                                                        hover:border-indigo-400">
                                                <div class="font-bold text-sm">양개</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 규격, 후렘두께, 하단 한 줄 -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">규격 및 하단 (mm)</label>
                                <div class="grid gap-2" style="grid-template-columns: 1fr 1fr 0.8fr 1.5fr;">
                                    <div>
                                        <input type="number" id="frameWidth" name="frameWidth" value="1000" min="1" max="5000" step="1" placeholder="가로"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-indigo-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5">가로</p>
                                    </div>
                                    <div>
                                        <input type="number" id="frameHeight" name="frameHeight" value="2100" min="1" max="5000" step="1" placeholder="세로"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-indigo-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5">세로</p>
                                    </div>
                                    <div>
                                        <input type="number" id="frameThickness" name="frameThickness" value="100" min="50" max="500" step="1" placeholder="후렘두께"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-indigo-600 focus:outline-none text-center">
                                        <p class="text-[10px] text-gray-500 mt-0.5 text-center">후렘두께</p>
                                    </div>
                                    <div id="frameOptionSelector">
                                        <select id="frameOption" name="frameOption" class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-indigo-600 focus:outline-none">
                                            <option value="hasten30">하스텐(30)</option>
                                            <option value="hasten10">하스텐(10)</option>
                                            <option value="steelBottom">철하단</option>
                                            <option value="threeSides">삼면</option>
                                        </select>
                                        <p class="text-[10px] text-gray-500 mt-0.5">하단</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 판넬용1.2T후렘 하단 타입 선택 (조건부 표시) -->
                            <div id="panelBottomTypeSelector" class="mb-3 hidden">
                                <label class="block text-xs font-bold text-gray-700 mb-2">
                                    <i class="fas fa-layer-group mr-1 text-blue-600"></i>하단 타입
                                </label>
                                <div class="grid grid-cols-3 gap-2">
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="panelBottomType" value="삼면" class="peer hidden" checked>
                                        <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                            <div class="font-semibold text-sm">삼면</div>
                                        </div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="panelBottomType" value="사면철" class="peer hidden">
                                        <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                            <div class="font-semibold text-sm">사면철</div>
                                        </div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="panelBottomType" value="하단스텐" class="peer hidden">
                                        <div class="border-2 border-gray-300 rounded-lg p-2 text-center hover:border-blue-500 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition">
                                            <div class="font-semibold text-sm">하단스텐</div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 문틀 추가 옵션 -->
                            <div class="frame-extra-options-section">
                                <label class="block text-xs font-bold text-gray-700 mb-3">문틀 추가 옵션</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="hinge">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>경첩</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="mortiseLock">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>모티스락</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="glassWool">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>글라스울</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="condensationHole">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>결로타공</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="firePin">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>방화핀</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="lamba">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>람마</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="smallPlatform">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>소대</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="sealCover">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>실커버</span>
                                        </div>
                                    </label>
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="frameExtraOptions" value="mortarJoint">
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>몰탈사춤</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <!-- 철판막음 버튼 -->
                                <div class="mt-4">
                                    <button type="button" id="openSteelPlateModalBtn" class="w-full px-4 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-lg hover:from-indigo-600 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i class="fas fa-layer-group mr-2"></i>
                                            <span class="font-semibold text-sm">철판막음 설정</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span id="steelPlateCountBadge" class="bg-white text-indigo-600 px-2 py-1 rounded-full text-xs font-bold">0개</span>
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </button>
                                </div>
                                
                                <!-- 숨겨진 철판막음 데이터 (폼 제출용) -->
                                <input type="hidden" id="steelPlate1Width" name="steelPlate1Width">
                                <input type="hidden" id="steelPlate1Height" name="steelPlate1Height">
                                <input type="hidden" id="steelPlate1Type" name="steelPlate1Type">
                                <input type="hidden" id="steelPlate2Width" name="steelPlate2Width">
                                <input type="hidden" id="steelPlate2Height" name="steelPlate2Height">
                                <input type="hidden" id="steelPlate2Type" name="steelPlate2Type">
                                <input type="hidden" id="steelPlate3Width" name="steelPlate3Width">
                                <input type="hidden" id="steelPlate3Height" name="steelPlate3Height">
                                <input type="hidden" id="steelPlate3Type" name="steelPlate3Type">
                                
                            </div>
                            
                            <!-- 도장비 입력 및 분체도장 관리 (판넬용1.2T후렘에서도 표시) -->
                            <div class="flex items-center gap-3 mt-4 pt-4 border-t border-gray-200">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="frameExtraOptions" value="painting" id="framePaintingCheckbox" disabled>
                                    <div class="checkbox-label">
                                        <div class="checkbox-icon"></div>
                                        <span>도장비</span>
                                    </div>
                                </label>
                                <div class="flex items-center gap-2">
                                    <input type="number" name="framePaintingCost" id="framePaintingCost" class="w-32 px-3 py-2 text-xs border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="금액 입력" oninput="enablePaintingCheckbox('frame')">
                                    <span class="text-xs text-gray-600">원</span>
                                </div>
                                <button type="button" onclick="openPowderCoatingModal()" class="ml-auto px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-xs font-semibold rounded-lg transition flex items-center gap-2">
                                    <i class="fas fa-paint-brush"></i>
                                    <span>분체도장 관리</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 문짝 입력 -->
                    <div id="doorSection" class="border-2 border-green-200 rounded-xl p-4 bg-green-50 transition-all">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg font-bold text-gray-800">
                                <i class="fas fa-door-open mr-2 text-green-600"></i>문짝 (Door)
                            </h3>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="doorEnableCheckbox" checked onchange="toggleDoorSection()" class="w-4 h-4 text-green-600 rounded focus:ring-2 focus:ring-green-500">
                                <span class="text-sm font-semibold text-gray-700">사용</span>
                            </label>
                        </div>
                        <div class="space-y-3">
                            <!-- 문짝 종류 선택 -->
                            <div>
                                <label class="block text-xs font-bold text-gray-700 mb-1.5">
                                    <i class="fas fa-layer-group text-green-600 mr-1"></i>문짝 종류
                                </label>
                                <div class="grid grid-cols-5 gap-1.5">
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="doorMaterial" value="egi" class="peer hidden" checked>
                                        <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                    peer-checked:border-green-600 peer-checked:bg-green-600 peer-checked:text-white peer-checked:shadow-md
                                                    hover:border-green-400">
                                            <div class="text-sm font-bold">EGI</div>
                                        </div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="doorMaterial" value="color" class="peer hidden">
                                        <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                    peer-checked:border-green-600 peer-checked:bg-green-600 peer-checked:text-white peer-checked:shadow-md
                                                    hover:border-green-400">
                                            <div class="text-sm font-bold">COLOR</div>
                                        </div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="doorMaterial" value="stainless" class="peer hidden">
                                        <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                    peer-checked:border-green-600 peer-checked:bg-green-600 peer-checked:text-white peer-checked:shadow-md
                                                    hover:border-green-400">
                                            <div class="text-sm font-bold">스텐레스</div>
                                        </div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="doorMaterial" value="kamachi" class="peer hidden">
                                        <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                    peer-checked:border-green-600 peer-checked:bg-green-600 peer-checked:text-white peer-checked:shadow-md
                                                    hover:border-green-400">
                                            <div class="text-sm font-bold">가마찌</div>
                                        </div>
                                    </label>
                                    <label class="relative cursor-pointer">
                                        <input type="radio" name="doorMaterial" value="sliding" class="peer hidden">
                                        <div class="border-2 border-gray-300 rounded-md px-2 py-1.5 text-center transition-all
                                                    peer-checked:border-green-600 peer-checked:bg-green-600 peer-checked:text-white peer-checked:shadow-md
                                                    hover:border-green-400">
                                            <div class="text-sm font-bold">슬라이딩</div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- COLOR 제품번호 + 규격 통합 (COLOR 선택 시만 표시) -->
                            <div id="colorProductNoField" style="display: none;">
                                <label class="block text-xs font-medium text-gray-700 mb-1">COLOR 제품NO / 규격 / 철판두께</label>
                                <div class="grid gap-2 items-center" style="grid-template-columns: 4fr 3fr 3fr 2fr;">
                                    <!-- COLOR 제품NO (4fr) -->
                                    <div>
                                        <input type="text" id="colorProductNo" name="colorProductNo" placeholder="예: 1231 또는 그레이투톤" 
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-green-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5" id="colorProductDesc">제품번호</p>
                                    </div>
                                    <!-- 규격 W (3fr) -->
                                    <div>
                                        <input type="number" id="colorDoorWidth" name="doorWidth" value="830" min="830" max="2463" step="1"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-green-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5">규격[W]</p>
                                    </div>
                                    <!-- 규격 H (3fr) -->
                                    <div>
                                        <input type="number" id="colorDoorHeight" name="doorHeight" value="2030" min="2030" max="4000" step="1"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-green-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5">규격[H]</p>
                                    </div>
                                    <!-- 철판 두께 라디오 버튼 (2fr, 2줄, 중간 정렬) -->
                                    <div class="flex flex-col gap-0.5 justify-center items-start" style="align-self: center;">
                                        <label class="flex items-center cursor-pointer text-[10px]">
                                            <input type="radio" name="steelPlateThickness" value="0.6t" class="mr-1">
                                            <span>0.6T</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer text-[10px]">
                                            <input type="radio" name="steelPlateThickness" value="0.8t" class="mr-1" checked>
                                            <span>0.8T</span>
                                        </label>
                                    </div>
                                </div>
                                <!-- 제품 설명 표시 영역 (철판두께 정보 제외) -->
                                <div class="mt-2">
                                    <p class="text-xs text-gray-600 italic" id="colorProductDetailDesc"></p>
                                </div>
                            </div>
                            
                            <!-- 일반 문짝 규격 입력 (COLOR 아닐 때만 표시) -->
                            <div id="normalDoorSizeField">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-xs font-medium text-gray-700">규격 (mm)</label>
                                    <div class="flex gap-1.5">
                                        <!-- COLOR가 아닐 때: 0.8T, 1.0T, 1.2T -->
                                        <label class="flex items-center cursor-pointer text-[10px]">
                                            <input type="radio" name="doorThickness" value="0.8" class="mr-0.5" checked>
                                            <span>0.8T</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer text-[10px]">
                                            <input type="radio" name="doorThickness" value="1.0" class="mr-0.5">
                                            <span>1.0T</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer text-[10px]">
                                            <input type="radio" name="doorThickness" value="1.2" class="mr-0.5">
                                            <span>1.2T</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <input type="number" id="doorWidth" name="doorWidth" value="830" min="830" max="2463" step="1"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-green-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5">가로</p>
                                    </div>
                                    <div>
                                        <input type="number" id="doorHeight" name="doorHeight" value="2030" min="2030" max="4000" step="1"
                                               class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:border-green-600 focus:outline-none">
                                        <p class="text-[10px] text-gray-500 mt-0.5">세로</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 문짝 추가 옵션 -->
                            <div class="door-extra-options-section">
                                <label class="block text-xs font-bold text-gray-700 mb-3">문짝 추가 옵션</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <!-- 동적으로 로드됨 -->
                                </div>
                                
                                <!-- 도장비 입력 (COLOR 타입일 때 숨김) -->
                                <div id="doorPaintingField" class="flex items-center gap-3 mt-4 pt-3 border-t border-gray-200">
                                    <label class="custom-checkbox">
                                        <input type="checkbox" name="doorExtraOptions" value="painting" id="doorPaintingCheckbox" disabled>
                                        <div class="checkbox-label">
                                            <div class="checkbox-icon"></div>
                                            <span>도장비</span>
                                        </div>
                                    </label>
                                    <div class="flex items-center gap-2">
                                        <input type="number" name="doorPaintingCost" id="doorPaintingCost" class="w-32 px-3 py-2 text-xs border rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="금액 입력" oninput="enablePaintingCheckbox('door')">
                                        <span class="text-xs text-gray-600">원</span>
                                    </div>
                                </div>
                                
                                <!-- 하드웨어 섹션 (문짝 섹션 안으로 복귀, !important로 배경색 고정) -->
                                <div id="hardwareSection" class="mt-4 pt-3 border-t border-gray-200 transition-all rounded-lg p-3" style="background-color: white !important;">
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="text-sm font-bold text-gray-800">
                                            <i class="fas fa-tools mr-1 text-yellow-600"></i>하드웨어
                                        </h4>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="hardwareEnableCheckbox" checked onchange="toggleHardwareSection()" class="w-4 h-4 text-yellow-600 rounded focus:ring-2 focus:ring-yellow-500">
                                            <span class="text-sm font-semibold text-gray-700">사용</span>
                                        </label>
                                    </div>
                                    <button type="button" onclick="openHardwareModal()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2">
                                        <i class="fas fa-tools"></i>
                                        <span>하드웨어 선택</span>
                                        <span id="hardwareCount" class="bg-yellow-700 px-2 py-1 rounded text-xs">0개 선택</span>
                                    </button>
                                    
                                    <!-- 선택된 하드웨어 목록 -->
                                    <div id="selectedHardwareList" class="mt-3 space-y-1 text-xs hidden">
                                        <!-- 동적으로 채워짐 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </form>
                
                <!-- 추가된 품목 목록 (2개 섹션) -->
                <div id="addedItemsSection" class="mt-4" style="display: none;">
                    <!-- 문틀/문짝/도장비 섹션 -->
                    <div class="bg-white rounded-xl shadow-md mb-3">
                        <div class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-3 py-2 rounded-t-xl">
                            <h4 class="text-sm font-bold flex items-center">
                                <i class="fas fa-door-closed mr-2"></i>문틀 / 문짝 / 도장비
                            </h4>
                        </div>
                        <!-- 헤더 -->
                        <div class="bg-blue-100 px-2 py-1 text-[9px] font-semibold text-gray-700 border-b border-blue-200">
                            <div class="grid grid-cols-12 gap-1">
                                <div class="col-span-1">품목</div>
                                <div class="col-span-1">규격</div>
                                <div class="col-span-1">후렘두께/하단</div>
                                <div class="col-span-1">문틀단가</div>
                                <div class="col-span-1">문짝단가</div>
                                <div class="col-span-1">문틀도장</div>
                                <div class="col-span-1">문짝도장</div>
                                <div class="col-span-1">합계</div>
                                <div class="col-span-1 text-center">수량</div>
                                <div class="col-span-1">공급가액</div>
                                <div class="col-span-2">특이사항</div>
                            </div>
                        </div>
                        <div id="doorItemsList" class="p-2">
                            <!-- 문틀/문짝 품목이 여기 표시됩니다 -->
                        </div>
                        <div class="bg-blue-50 px-3 py-2 border-t border-blue-100 flex justify-between items-center">
                            <span class="text-xs font-semibold text-gray-700">소계</span>
                            <span class="text-sm font-bold text-blue-600" id="door-subtotal">0원</span>
                        </div>
                    </div>
                    
                    <!-- 하드웨어 섹션 -->
                    <div class="bg-white rounded-xl shadow-md mb-3">
                        <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-3 py-2 rounded-t-xl">
                            <h4 class="text-sm font-bold flex items-center">
                                <i class="fas fa-tools mr-2"></i>하드웨어
                            </h4>
                        </div>
                        <!-- 헤더 (5개 필드: 품목, 수량, 단가, 공급가액, 특이사항) -->
                        <div class="bg-yellow-100 px-2 py-1 text-[9px] font-semibold text-gray-700 border-b border-yellow-200">
                            <div class="grid grid-cols-12 gap-1">
                                <div class="col-span-4">품목</div>
                                <div class="col-span-1 text-center">수량</div>
                                <div class="col-span-2">단가</div>
                                <div class="col-span-2">공급가액</div>
                                <div class="col-span-3">특이사항</div>
                            </div>
                        </div>
                        <div id="hardwareItemsList" class="p-2">
                            <!-- 하드웨어 품목이 여기 표시됩니다 -->
                        </div>
                        <div class="bg-yellow-50 px-3 py-2 border-t border-yellow-100 flex justify-between items-center">
                            <span class="text-xs font-semibold text-gray-700">소계</span>
                            <span class="text-sm font-bold text-orange-600" id="hardware-subtotal">0원</span>
                        </div>
                    </div>
                    
                    <!-- 총 합계 -->
                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl px-4 py-3 shadow-lg">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-bold">
                                <i class="fas fa-calculator mr-2"></i>총 합계금액
                            </span>
                            <span class="text-xl font-bold" id="added-items-total">0원</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 중앙: 문틀 견적 (1/4) -->
            <div class="bg-white rounded-2xl shadow-xl p-4">
                <h3 class="text-base font-bold text-indigo-700 mb-3 flex items-center">
                    <i class="fas fa-border-style mr-2"></i>문틀 견적
                </h3>
                <div id="frameResult"></div>
            </div>

            <!-- 오른쪽: 문짝 견적 (1/4) -->
            <div class="bg-white rounded-2xl shadow-xl p-4">
                <h3 class="text-base font-bold text-green-700 mb-3 flex items-center">
                    <i class="fas fa-door-closed mr-2"></i>문짝 견적
                </h3>
                <div id="doorResult"></div>
                
                <!-- 하드웨어 견적 테이블 -->
                <div id="hardwareResultTable" class="mt-4" style="display: none;">
                </div>
            </div>
        </div>

        <!-- 하드웨어 모달 -->
    <div id="hardwareModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden">
            <!-- 모달 헤더 -->
            <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white p-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-tools text-2xl"></i>
                    <h2 class="text-2xl font-bold">하드웨어 선택</h2>
                </div>
                <button onclick="closeHardwareModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 탭 메뉴 -->
            <div class="border-b bg-gray-50">
                <div class="flex overflow-x-auto">
                    <button onclick="switchHardwareTab('doorlock')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap active" data-tab="doorlock">
                        <i class="fas fa-lock mr-1"></i>도어록
                    </button>
                    <button onclick="switchHardwareTab('doorcheck')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="doorcheck">
                        <i class="fas fa-door-closed mr-1"></i>도어체크
                    </button>
                    <button onclick="switchHardwareTab('cuphandle')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="cuphandle">
                        <i class="fas fa-grip-horizontal mr-1"></i>컵핸들
                    </button>
                    <button onclick="switchHardwareTab('digitalkey')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="digitalkey">
                        <i class="fas fa-key mr-1"></i>디지털키
                    </button>
                    <button onclick="switchHardwareTab('hinge')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="hinge">
                        <i class="fas fa-angle-double-right mr-1"></i>경첩
                    </button>
                    <button onclick="switchHardwareTab('offset')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="offset">
                        <i class="fas fa-arrows-alt-h mr-1"></i>옵셋힌지
                    </button>
                    <button onclick="switchHardwareTab('packing')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="packing">
                        <i class="fas fa-tape mr-1"></i>패킹
                    </button>
                    <button onclick="switchHardwareTab('pivot')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="pivot">
                        <i class="fas fa-redo mr-1"></i>피봇힌지
                    </button>
                    <button onclick="switchHardwareTab('etc')" class="hardware-tab px-4 py-3 text-sm font-semibold border-b-2 border-transparent hover:bg-yellow-50 hover:border-yellow-400 transition whitespace-nowrap" data-tab="etc">
                        <i class="fas fa-ellipsis-h mr-1"></i>기타
                    </button>
                </div>
            </div>
            
            <!-- 모달 바디 -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-280px)]">
                <div id="hardwareList" class="grid grid-cols-2 gap-3">
                    <!-- 동적으로 로드됨 -->
                    <div class="col-span-2 text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
                        <p>하드웨어 목록을 불러오는 중...</p>
                    </div>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="border-t p-6 flex justify-between items-center bg-gray-50">
                <div class="flex gap-3">
                    <button onclick="openAddHardwareForm()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition">
                        <i class="fas fa-plus mr-2"></i>하드웨어 추가
                    </button>
                    <div class="text-sm text-gray-600 flex items-center">
                        <span id="modalHardwareCount">0개 선택됨</span>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeHardwareModal()" class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold transition">
                        취소
                    </button>
                    <button onclick="applyHardware()" class="px-6 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-semibold transition">
                        적용
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 하드웨어 추가/수정 폼 모달 -->
    <div id="hardwareFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full">
            <!-- 모달 헤더 -->
            <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white p-6 flex justify-between items-center rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <i class="fas fa-edit text-2xl"></i>
                    <h2 class="text-2xl font-bold" id="formModalTitle">하드웨어 추가</h2>
                </div>
                <button onclick="closeHardwareFormModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 폼 바디 -->
            <div class="p-6">
                <form id="hardwareForm" class="space-y-4">
                    <input type="hidden" id="form_original_code" value="">
                    
                    <!-- 코드 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-barcode text-blue-600 mr-1"></i>하드웨어 코드 *
                        </label>
                        <input type="text" id="form_code" required
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                               placeholder="예: HW001">
                        <p class="text-xs text-gray-500 mt-1">고유한 코드를 입력하세요 (수정 시 변경 불가)</p>
                    </div>
                    
                    <!-- 이름 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-tag text-blue-600 mr-1"></i>하드웨어 이름 *
                        </label>
                        <input type="text" id="form_name" required
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                               placeholder="예: 도어체크 TS5000">
                    </div>
                    
                    <!-- 카테고리 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-folder text-blue-600 mr-1"></i>카테고리 *
                        </label>
                        <select id="form_category" required
                                class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none">
                            <option value="doorlock">도어록</option>
                            <option value="doorcheck">도어체크</option>
                            <option value="cuphandle">컵핸들</option>
                            <option value="digitalkey">디지털키</option>
                            <option value="hinge">경첩</option>
                            <option value="offset">옵셋힌지</option>
                            <option value="packing">패킹</option>
                            <option value="pivot">피봇힌지</option>
                            <option value="etc">기타</option>
                        </select>
                    </div>
                    
                    <!-- 가격 -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">
                                <i class="fas fa-shopping-cart text-blue-600 mr-1"></i>매입가 *
                            </label>
                            <input type="number" id="form_purchase_price" required min="0"
                                   class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                                   placeholder="50000">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">
                                <i class="fas fa-dollar-sign text-green-600 mr-1"></i>판매가 *
                            </label>
                            <input type="number" id="form_sale_price" required min="0"
                                   class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                                   placeholder="70000">
                        </div>
                    </div>
                    
                    <!-- 설명 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-comment text-blue-600 mr-1"></i>설명 (선택)
                        </label>
                        <textarea id="form_description" rows="3"
                                  class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                                  placeholder="하드웨어 설명을 입력하세요"></textarea>
                    </div>
                </form>
            </div>
            
            <!-- 폼 푸터 -->
            <div class="border-t p-6 flex justify-end gap-3 bg-gray-50">
                <button onclick="closeHardwareFormModal()" class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold transition">
                    취소
                </button>
                <button onclick="saveHardware()" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition">
                    <i class="fas fa-save mr-2"></i>저장
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="/static/app.js"></script>
    <script>
        // 하드웨어 목록 전역 변수
        let hardwareList = [];
        let currentHardwareTab = 'doorlock'; // 현재 선택된 탭
        let selectedHardwareCodes = []; // 선택된 하드웨어 코드 저장
        window.selectedHardwareCodes = selectedHardwareCodes; // window 객체에 추가
        
        // 견적서 관리 전역 변수 (Proxy로 추적)
        let _currentQuotationId = null;
        Object.defineProperty(window, 'currentQuotationId', {
            get: function() {
                return _currentQuotationId;
            },
            set: function(value) {
                console.log(`🔄 currentQuotationId 변경: ${_currentQuotationId} → ${value}`);
                console.trace('변경 위치:');
                _currentQuotationId = value;
            },
            configurable: true
        });
        
        // 하드웨어 카테고리 매핑
        const hardwareCategories = {
            'doorlock': '도어록',
            'doorcheck': '도어체크',
            'cuphandle': '컵핸들',
            'digitalkey': '디지털키',
            'hinge': '경첩',
            'offset': '옵셋힌지',
            'packing': '패킹',
            'pivot': '피봇힌지',
            'etc': '기타'
        };
        
        // 탭 전환
        function switchHardwareTab(category) {
            currentHardwareTab = category;
            
            // 탭 버튼 스타일 업데이트
            document.querySelectorAll('.hardware-tab').forEach(tab => {
                if (tab.dataset.tab === category) {
                    tab.classList.add('active', 'border-yellow-500', 'bg-yellow-50', 'text-yellow-700');
                    tab.classList.remove('border-transparent');
                } else {
                    tab.classList.remove('active', 'border-yellow-500', 'bg-yellow-50', 'text-yellow-700');
                    tab.classList.add('border-transparent');
                }
            });
            
            // 하드웨어 목록 렌더링 (선택 상태는 renderHardwareList에서 자동 복원)
            renderHardwareList(category);
        }
        
        // 하드웨어 목록 로드
        async function loadHardwareList() {
            try {
                const response = await axios.get('api/hardware');
                if (response.data.success) {
                    hardwareList = response.data.hardware;
                    // 초기 탭 렌더링
                    switchHardwareTab(currentHardwareTab);
                } else {
                    showHardwareError('하드웨어 목록을 불러오지 못했습니다.');
                }
            } catch (error) {
                console.error('하드웨어 목록 로드 실패:', error);
                showHardwareError('하드웨어 목록을 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 하드웨어 목록 렌더링 (카테고리별)
        function renderHardwareList(category) {
            const container = document.getElementById('hardwareList');
            
            // 카테고리별 필터링
            const filteredList = hardwareList.filter(item => item.category === category);
            
            if (filteredList.length === 0) {
                container.innerHTML = `
                    <div class="col-span-2 text-center py-8 text-gray-500">
                        <i class="fas fa-exclamation-circle text-3xl mb-2"></i>
                        <p>${hardwareCategories[category]} 카테고리에 등록된 하드웨어가 없습니다.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredList.map(item => `
                <div class="border-2 rounded-lg p-4 hover:bg-yellow-50 hover:border-yellow-500 transition">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" name="hardware" value="${item.code}" 
                               data-name="${item.name}" 
                               data-price="${item.sale_price}" 
                               class="mt-1 w-5 h-5 flex-shrink-0 cursor-pointer">
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-sm font-bold text-gray-800">${item.name}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-xs mb-2">
                                <div class="flex items-center gap-1 text-blue-600">
                                    <i class="fas fa-shopping-cart"></i>
                                    <span class="font-semibold">매입:</span>
                                    <span class="font-bold">₩${formatNumber(item.purchase_price)}</span>
                                </div>
                                <div class="flex items-center gap-1 text-green-600">
                                    <i class="fas fa-tag"></i>
                                    <span class="font-semibold">판매:</span>
                                    <span class="font-bold">₩${formatNumber(item.sale_price)}</span>
                                </div>
                            </div>
                            ${item.description ? `<div class="text-xs text-gray-500 mb-2">${item.description}</div>` : ''}
                            <div class="flex gap-2 mt-2">
                                <button onclick="openEditHardwareForm('${item.code}')" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded transition">
                                    <i class="fas fa-edit mr-1"></i>수정
                                </button>
                                <button onclick="deleteHardware('${item.code}', '${item.name.replace(/'/g, "\\'")}')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded transition">
                                    <i class="fas fa-trash mr-1"></i>삭제
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // 체크박스 이벤트 리스너 추가
            const checkboxes = container.querySelectorAll('input[name="hardware"]');
            checkboxes.forEach(checkbox => {
                // 저장된 선택 상태 복원
                if (selectedHardwareCodes.includes(checkbox.value)) {
                    checkbox.checked = true;
                }
                
                // 체크박스 변경 시 전역 변수 업데이트
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (!selectedHardwareCodes.includes(this.value)) {
                            selectedHardwareCodes.push(this.value);
                            window.selectedHardwareCodes = selectedHardwareCodes; // window 업데이트
                        }
                    } else {
                        selectedHardwareCodes = selectedHardwareCodes.filter(code => code !== this.value);
                        window.selectedHardwareCodes = selectedHardwareCodes; // window 업데이트
                    }
                    updateModalHardwareCount();
                });
            });
        }
        
        // 에러 표시
        function showHardwareError(message) {
            const container = document.getElementById('hardwareList');
            container.innerHTML = `
                <div class="col-span-2 text-center py-8 text-red-500">
                    <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // 숫자 포맷팅 (천단위 콤마)
        function formatNumber(num) {
            if (num === undefined || num === null || isNaN(num)) {
                return '0';
            }
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        // 하드웨어 모달 열기
        function openHardwareModal() {
            // 첫 로드 시에만 하드웨어 목록 로드
            if (hardwareList.length === 0) {
                loadHardwareList();
            }
            document.getElementById('hardwareModal').classList.remove('hidden');
            updateModalHardwareCount();
        }
        
        // 하드웨어 모달 닫기
        function closeHardwareModal() {
            document.getElementById('hardwareModal').classList.add('hidden');
        }
        
        // 하드웨어 추가 폼 열기
        function openAddHardwareForm() {
            document.getElementById('formModalTitle').textContent = '하드웨어 추가';
            document.getElementById('form_original_code').value = '';
            document.getElementById('form_code').value = '';
            document.getElementById('form_code').readOnly = false;
            document.getElementById('form_name').value = '';
            document.getElementById('form_category').value = currentHardwareTab;
            document.getElementById('form_purchase_price').value = '';
            document.getElementById('form_sale_price').value = '';
            document.getElementById('form_description').value = '';
            document.getElementById('hardwareFormModal').classList.remove('hidden');
        }
        
        // 하드웨어 수정 폼 열기
        function openEditHardwareForm(code) {
            const item = hardwareList.find(h => h.code === code);
            if (!item) {
                alert('하드웨어를 찾을 수 없습니다.');
                return;
            }
            
            document.getElementById('formModalTitle').textContent = '하드웨어 수정';
            document.getElementById('form_original_code').value = code;
            document.getElementById('form_code').value = code;
            document.getElementById('form_code').readOnly = true;
            document.getElementById('form_name').value = item.name;
            document.getElementById('form_category').value = item.category;
            document.getElementById('form_purchase_price').value = item.purchase_price;
            document.getElementById('form_sale_price').value = item.sale_price;
            document.getElementById('form_description').value = item.description || '';
            document.getElementById('hardwareFormModal').classList.remove('hidden');
        }
        
        // 하드웨어 폼 모달 닫기
        function closeHardwareFormModal() {
            document.getElementById('hardwareFormModal').classList.add('hidden');
        }
        
        // 하드웨어 저장 (추가/수정)
        async function saveHardware() {
            const originalCode = document.getElementById('form_original_code').value;
            const code = document.getElementById('form_code').value.trim();
            const name = document.getElementById('form_name').value.trim();
            const category = document.getElementById('form_category').value;
            const purchase_price = parseFloat(document.getElementById('form_purchase_price').value) || 0;
            const sale_price = parseFloat(document.getElementById('form_sale_price').value) || 0;
            const description = document.getElementById('form_description').value.trim();
            
            // 유효성 검사
            if (!code || !name || !category) {
                alert('필수 필드를 모두 입력해주세요.');
                return;
            }
            
            if (purchase_price < 0 || sale_price < 0) {
                alert('가격은 0 이상이어야 합니다.');
                return;
            }
            
            const data = { code, name, category, purchase_price, sale_price, description };
            
            try {
                let response;
                if (originalCode) {
                    // 수정
                    response = await axios.put(`/api/hardware/${originalCode}`, data);
                } else {
                    // 추가
                    response = await axios.post('api/hardware', data);
                }
                
                if (response.data.success) {
                    alert(response.data.message);
                    closeHardwareFormModal();
                    // 목록 새로고침
                    await loadHardwareList();
                } else {
                    alert('오류: ' + response.data.message);
                }
            } catch (error) {
                console.error('저장 실패:', error);
                alert('저장 중 오류가 발생했습니다: ' + (error.response?.data?.message || error.message));
            }
        }
        
        // 하드웨어 삭제
        async function deleteHardware(code, name) {
            if (!confirm(`정말로 "${name}"을(를) 삭제하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await axios.delete(`/api/hardware/${code}`);
                
                if (response.data.success) {
                    alert(response.data.message);
                    // 목록 새로고침
                    await loadHardwareList();
                } else {
                    alert('오류: ' + response.data.message);
                }
            } catch (error) {
                console.error('삭제 실패:', error);
                alert('삭제 중 오류가 발생했습니다: ' + (error.response?.data?.message || error.message));
            }
        }
        
        // 하드웨어 적용 - 견적 품목에 직접 추가 (로컬스토리지)
        function applyHardware() {
            if (selectedHardwareCodes.length === 0) {
                alert('⚠️ 하드웨어를 선택해주세요.');
                return;
            }
            
            try {
                // 체크된 하드웨어 정보 가져오기 (DOM에서)
                const checkedCheckboxes = document.querySelectorAll('input[name="hardware"]:checked');
                const hardwareItems = [];
                
                checkedCheckboxes.forEach(checkbox => {
                    const name = checkbox.getAttribute('data-name');
                    const price = parseInt(checkbox.getAttribute('data-price')) || 0;
                    
                    if (name) {
                        hardwareItems.push({ name, price });
                    }
                });
                
                if (hardwareItems.length === 0) {
                    alert('⚠️ 선택된 하드웨어 정보를 찾을 수 없습니다.');
                    return;
                }
                
                console.log(`🔧 하드웨어 ${hardwareItems.length}개 추가 시작`);
                
                // 각 하드웨어를 개별 품목으로 추가 (로컬스토리지)
                let successCount = 0;
                let failCount = 0;
                
                for (const item of hardwareItems) {
                    try {
                        const itemData = {
                            fire_door_type: item.name,
                            frame_width: '',
                            frame_height: '',
                            frame_thickness_info: '',
                            frame_price: 0,
                            door_price: 0,
                            frame_painting_price: 0,
                            door_painting_price: 0,
                            hardware_price: item.price,
                            total_price: item.price,
                            quantity: 1,
                            supply_price: item.price,
                            notes: ''
                        };
                        
                        console.log(`  ➕ ${item.name} (${item.price.toLocaleString()}원) 추가 중...`);
                        
                        // 로컬스토리지에 추가 (app.js의 함수 사용)
                        const itemId = addToLocalQuotation(itemData);
                        
                        if (itemId) {
                            successCount++;
                            console.log(`  ✅ ${item.name} 추가 성공`);
                        } else {
                            failCount++;
                            console.error(`  ❌ ${item.name} 추가 실패`);
                        }
                    } catch (error) {
                        failCount++;
                        console.error(`  ❌ ${item.name} 추가 실패:`, error);
                    }
                }
                
                // 결과 알림
                if (successCount > 0) {
                    alert(`✅ ${successCount}개 하드웨어가 견적에 추가되었습니다.${failCount > 0 ? `\n⚠️ ${failCount}개는 추가 실패` : ''}`);
                    
                    // 모달 닫기 (체크박스는 유지 - 가격 계산에 사용)
                    closeHardwareModal();
                    
                    // 견적 품목 배지 및 목록 업데이트
                    updateQuotationItemsBadge();
                    updateAddedItemsList();
                    
                    // 견적 품목 관리 모달이 열려있으면 갱신
                    const modal = document.getElementById('quotationItemsModal');
                    if (!modal.classList.contains('hidden')) {
                        loadQuotationItems();
                    }
                    
                    // ✅ 추가: 가격 계산 다시 실행 (하드웨어 포함)
                    if (typeof calculatePrice === 'function') {
                        console.log('🔄 하드웨어 적용 후 가격 재계산 시작...');
                        calculatePrice();
                        console.log('✅ 가격 재계산 완료');
                    }
                } else {
                    alert('❌ 모든 하드웨어 추가에 실패했습니다.');
                }
            } catch (error) {
                console.error('하드웨어 추가 실패:', error);
                alert('하드웨어를 추가하는 중 오류가 발생했습니다.');
            }
        }
        
        // 도장비 체크박스 활성화/비활성화
        function enablePaintingCheckbox(type) {
            if (type === 'frame') {
                const input = document.getElementById('framePaintingCost');
                const checkbox = document.getElementById('framePaintingCheckbox');
                
                if (input && checkbox) {
                    const value = parseInt(input.value) || 0;
                    if (value > 0) {
                        // 금액이 입력되면 체크박스 활성화 (사용자가 직접 체크)
                        checkbox.disabled = false;
                    } else {
                        // 금액이 없으면 체크박스 비활성화 및 체크 해제
                        checkbox.disabled = true;
                        checkbox.checked = false;
                    }
                }
            } else if (type === 'door') {
                const input = document.getElementById('doorPaintingCost');
                const checkbox = document.getElementById('doorPaintingCheckbox');
                
                if (input && checkbox) {
                    const value = parseInt(input.value) || 0;
                    if (value > 0) {
                        // 금액이 입력되면 체크박스 활성화 (사용자가 직접 체크)
                        checkbox.disabled = false;
                    } else {
                        // 금액이 없으면 체크박스 비활성화 및 체크 해제
                        checkbox.disabled = true;
                        checkbox.checked = false;
                    }
                }
            }
        }
        
        // 문틀 섹션 활성화/비활성화
        function toggleFrameSection() {
            const checkbox = document.getElementById('frameEnableCheckbox');
            const section = document.getElementById('frameSection');
            
            if (checkbox.checked) {
                // 활성화
                section.classList.remove('bg-gray-100');
                section.classList.add('bg-indigo-50');
                console.log('✅ 문틀 섹션 활성화');
            } else {
                // 비활성화 - 투명도 제거, 배경색만 회색으로 변경
                section.classList.add('bg-gray-100');
                section.classList.remove('bg-indigo-50');
                console.log('❌ 문틀 섹션 비활성화 - 금액 0원 처리 (투명도 없음)');
            }
            
            // 계산 재실행
            if (typeof calculatePrice === 'function') {
                calculatePrice();
            }
        }
        
        // 문짝 섹션 활성화/비활성화
        function toggleDoorSection() {
            const checkbox = document.getElementById('doorEnableCheckbox');
            const section = document.getElementById('doorSection');
            
            if (checkbox.checked) {
                // 활성화
                section.classList.remove('bg-gray-100');
                section.classList.add('bg-green-50');
                console.log('✅ 문짝 섹션 활성화');
            } else {
                // 비활성화 - 투명도 제거, 배경색만 회색으로 변경
                section.classList.add('bg-gray-100');
                section.classList.remove('bg-green-50');
                console.log('❌ 문짝 섹션 비활성화 - 금액 0원 처리 (투명도 없음)');
            }
            
            // 계산 재실행
            if (typeof calculatePrice === 'function') {
                calculatePrice();
            }
        }
        
        // 하드웨어 섹션 활성화/비활성화
        function toggleHardwareSection() {
            const checkbox = document.getElementById('hardwareEnableCheckbox');
            const section = document.getElementById('hardwareSection');
            
            // 배경색과 투명도는 절대 변경하지 않음
            // 체크박스 상태만 저장하고 계산 시 사용
            
            if (checkbox.checked) {
                console.log('✅ 하드웨어 섹션 활성화');
            } else {
                console.log('❌ 하드웨어 섹션 비활성화 - 금액 0원 처리 (시각적 변화 없음)');
            }
            
            // 계산 재실행
            if (typeof calculatePrice === 'function') {
                calculatePrice();
            }
        }
        
        // 하드웨어 선택 개수 업데이트
        function updateHardwareCount() {
            // 전역 변수에서 선택된 하드웨어 개수 가져오기
            const count = selectedHardwareCodes.length;
            
            // 개수 업데이트
            document.getElementById('hardwareCount').textContent = count + '개 선택';
            
            // 선택된 하드웨어 목록 표시
            const listContainer = document.getElementById('selectedHardwareList');
            
            if (count === 0) {
                listContainer.classList.add('hidden');
                listContainer.innerHTML = '';
            } else {
                listContainer.classList.remove('hidden');
                
                // 전역 변수에서 선택된 하드웨어 정보 가져오기
                const selectedItems = selectedHardwareCodes.map(code => {
                    const hardware = hardwareList.find(h => h.code === code);
                    
                    if (hardware) {
                        return {
                            name: hardware.name,
                            price: `₩${formatNumber(hardware.sale_price)}`
                        };
                    }
                    
                    return {
                        name: '알 수 없음',
                        price: '₩0'
                    };
                });
                
                // HTML 생성
                listContainer.innerHTML = selectedItems.map(item => `
                    <div class="flex justify-between items-center p-2 bg-yellow-50 rounded border border-yellow-200">
                        <span class="text-gray-700 font-medium">${item.name}</span>
                        <span class="text-yellow-700 font-bold">${item.price}</span>
                    </div>
                `).join('');
            }
        }
        
        // 모달 내 선택 개수 업데이트
        function updateModalHardwareCount() {
            const checked = document.querySelectorAll('input[name="hardware"]:checked');
            document.getElementById('modalHardwareCount').textContent = checked.length + '개 선택됨';
        }
        
        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeHardwareModal();
            }
        });
        
        // 방화문 타입에 따라 문틀 높이 제한 업데이트
        function updateFrameHeightLimit() {
            const fireDoorType = document.querySelector('input[name="fireDoorType"]:checked')?.value || 'sd';
            const frameHeightInput = document.getElementById('frameHeight');
            
            if (!frameHeightInput) return;
            
            // panel-1.2t: 2100mm, 나머지: 4000mm
            const maxHeight = fireDoorType === 'panel-1.2t' ? 2100 : 4000;
            frameHeightInput.max = maxHeight;
            
            // 현재 값이 최대값을 초과하면 자동 조정
            if (parseInt(frameHeightInput.value) > maxHeight) {
                frameHeightInput.value = maxHeight;
            }
            
            console.log(`방화문 타입: ${fireDoorType}, 문틀 높이 제한: ${maxHeight}mm`);
        }
        
        // 방화문 타입 선택 시 추가옵션 자동 체크
        async function autoCheckFrameOptions() {
            try {
                // 현재 선택된 방화문 타입
                const fireDoorType = document.querySelector('input[name="fireDoorType"]:checked')?.value;
                if (!fireDoorType) return;
                
                // 타입 매핑 (calculator의 value → settings의 key)
                const typeMapping = {
                    'sd': 'sd',
                    'sd-insulated': 'sd-insulated',
                    'sd-insulated-eu': 'sd-insulated-eu',
                    'panel-1.2t': 'panel-1.2t',
                    'fsd': 'fsd',
                    'certified': 'certified',
                    'pig-barn': 'pig-barn'
                };
                
                const settingsKey = typeMapping[fireDoorType];
                if (!settingsKey) return;
                
                // 서버에서 설정 가져오기
                const response = await axios.get('api/settings/door-options');
                if (!response.data.success) return;
                
                const frameOptions = response.data.settings[settingsKey]?.frame || [];
                const doorOptions = response.data.settings[settingsKey]?.door || [];
                
                console.log(`🔄 ${fireDoorType} 타입 추가옵션 적용 시작...`);
                console.log('   문틀 옵션:', frameOptions);
                console.log('   문짝 옵션:', doorOptions);
                
                // 1️⃣ 먼저 모든 체크박스를 해제 (이전 타입 선택 리셋)
                document.querySelectorAll('[name="frameExtraOptions"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                document.querySelectorAll('[name="doorExtraOptions"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // 2️⃣ 새 타입의 설정된 옵션만 체크
                document.querySelectorAll('[name="frameExtraOptions"]').forEach(checkbox => {
                    if (frameOptions.includes(checkbox.value)) {
                        checkbox.checked = true;
                        console.log(`   ✅ 문틀: ${checkbox.value} 체크`);
                    }
                });
                
                document.querySelectorAll('[name="doorExtraOptions"]').forEach(checkbox => {
                    if (doorOptions.includes(checkbox.value)) {
                        checkbox.checked = true;
                        console.log(`   ✅ 문짝: ${checkbox.value} 체크`);
                    }
                });
                
                console.log(`✅ ${fireDoorType} 타입 추가옵션 자동 체크 완료`);
                
                // 철판막음 입력란 업데이트
                if (typeof updateSteelPlateInputs === 'function') {
                    updateSteelPlateInputs();
                }
                
                // 3️⃣ 견적 자동 재계산 (체크박스 변경 반영)
                if (typeof calculatePrice === 'function') {
                    console.log('💰 견적 자동 재계산 시작...');
                    await calculatePrice();
                    console.log('✅ 견적 재계산 완료!');
                }
            } catch (error) {
                console.error('❌ 추가옵션 자동 체크 실패:', error);
            }
        }
        
        // 페이지 로드 시 초기 제한 설정 및 추가옵션 자동 체크
        updateFrameHeightLimit();
        autoCheckFrameOptions();
        
        // 방화문 타입 변경 시 제한 업데이트 및 추가옵션 자동 체크
        document.querySelectorAll('input[name="fireDoorType"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updateFrameHeightLimit();
                autoCheckFrameOptions();
            });
        });
        
        // ========================================
        // 매입단가 모달
        // ========================================
        
        function openPowderCoatingModal() {
            const modal = document.getElementById('powderCoatingModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // iframe 로드
            const iframe = document.getElementById('powderCoatingIframe');
            if (!iframe.src) {
                iframe.src = '/admin-powder-coating.html';
            }
        }
        
        function closePowderCoatingModal() {
            const modal = document.getElementById('powderCoatingModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
        
        // ESC 키로 모달 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePowderCoatingModal();
            }
        });
        
        // ========================================
        // 철판막음 기능
        // ========================================
        
        let steelPlateCount = 1; // 현재 표시된 철판막음 개수
        
        // 철판막음 추가 버튼
        function addSteelPlate() {
            if (steelPlateCount >= 3) {
                alert('철판막음은 최대 3개까지만 추가할 수 있습니다.');
                return;
            }
            
            steelPlateCount++;
            
            // 해당 컨테이너 표시
            const container = document.getElementById(`steelPlate${steelPlateCount}Container`);
            if (container) {
                container.style.display = 'flex';
            }
            
            // 개수 표시 업데이트
            document.getElementById('steelPlateCount').textContent = `(${steelPlateCount}/3)`;
            
            // 람바/소대 체크 상태에 따라 활성화
            updateSteelPlateInputs();
            
            // 버튼 비활성화 (3개 도달 시)
            if (steelPlateCount >= 3) {
                document.getElementById('addSteelPlateBtn').disabled = true;
                document.getElementById('addSteelPlateBtn').classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // 철판막음 입력란 활성화/비활성화
        function updateSteelPlateInputs() {
            const lambaChecked = document.querySelector('[name="frameExtraOptions"][value="lamba"]')?.checked || false;
            const smallPlatformChecked = document.querySelector('[name="frameExtraOptions"][value="smallPlatform"]')?.checked || false;
            
            // 람바 OR 소대가 체크되어 있으면 활성화
            const shouldEnable = lambaChecked || smallPlatformChecked;
            
            // 현재 표시된 철판막음들만 처리
            for (let i = 1; i <= steelPlateCount; i++) {
                const widthInput = document.getElementById(`steelPlate${i}Width`);
                const heightInput = document.getElementById(`steelPlate${i}Height`);
                
                if (widthInput && heightInput) {
                    if (shouldEnable) {
                        // 입력란 활성화
                        widthInput.disabled = false;
                        heightInput.disabled = false;
                        widthInput.classList.remove('bg-gray-100', 'cursor-not-allowed');
                        heightInput.classList.remove('bg-gray-100', 'cursor-not-allowed');
                    } else {
                        // 입력란 비활성화 및 초기화
                        widthInput.disabled = true;
                        heightInput.disabled = true;
                        widthInput.value = '';
                        heightInput.value = '';
                        widthInput.classList.add('bg-gray-100', 'cursor-not-allowed');
                        heightInput.classList.add('bg-gray-100', 'cursor-not-allowed');
                        
                        // 체크박스, 라디오 비활성화 및 초기화
                        updateSteelPlateCheckbox(i, false);
                    }
                }
            }
        }
        
        // 철판막음 체크박스 활성화/비활성화
        function updateSteelPlateCheckbox(num, enabled) {
            const checkbox = document.getElementById(`steelPlate${num}Checkbox`);
            const singleRadio = document.querySelector(`[name="colorPlate${num}Type"][value="single"]`);
            const doubleRadio = document.querySelector(`[name="colorPlate${num}Type"][value="double"]`);
            
            if (!checkbox) return;
            
            if (enabled) {
                checkbox.disabled = false;
                checkbox.parentElement.classList.remove('opacity-50');
            } else {
                checkbox.disabled = true;
                checkbox.checked = false;
                checkbox.parentElement.classList.add('opacity-50');
                
                // 라디오 버튼도 비활성화
                if (singleRadio) {
                    singleRadio.disabled = true;
                    singleRadio.checked = false;
                    singleRadio.parentElement.classList.add('opacity-50');
                }
                if (doubleRadio) {
                    doubleRadio.disabled = true;
                    doubleRadio.checked = false;
                    doubleRadio.parentElement.classList.add('opacity-50');
                }
            }
        }
        
        // 철판막음 규격 입력 시 라디오 버튼 활성화
        function enableSteelPlateRadios(num) {
            const widthInput = document.getElementById(`steelPlate${num}Width`);
            const heightInput = document.getElementById(`steelPlate${num}Height`);
            const baseRadio = document.querySelector(`[name="steelPlate${num}Type"][value="base"]`);
            const singleRadio = document.querySelector(`[name="steelPlate${num}Type"][value="single"]`);
            const doubleRadio = document.querySelector(`[name="steelPlate${num}Type"][value="double"]`);
            
            const width = parseInt(widthInput?.value);
            const height = parseInt(heightInput?.value);
            
            console.log(`🔧 enableSteelPlateRadios(${num}): width=${width}, height=${height}`);
            
            // 가로/세로 둘 다 입력되었으면 라디오 버튼 활성화
            if (width > 0 && height > 0) {
                console.log(`✅ 철판막음${num} 라디오 활성화: ${width}×${height}`);
                
                if (baseRadio) {
                    baseRadio.disabled = false;
                    baseRadio.parentElement.classList.remove('opacity-50');
                }
                if (singleRadio) {
                    singleRadio.disabled = false;
                    singleRadio.parentElement.classList.remove('opacity-50');
                }
                if (doubleRadio) {
                    doubleRadio.disabled = false;
                    doubleRadio.parentElement.classList.remove('opacity-50');
                }
            } else {
                // 값이 없으면 비활성화
                if (baseRadio) {
                    baseRadio.disabled = true;
                    baseRadio.checked = false;
                    baseRadio.parentElement.classList.add('opacity-50');
                }
                if (singleRadio) {
                    singleRadio.disabled = true;
                    singleRadio.checked = false;
                    singleRadio.parentElement.classList.add('opacity-50');
                }
                if (doubleRadio) {
                    doubleRadio.disabled = true;
                    doubleRadio.checked = false;
                    doubleRadio.parentElement.classList.add('opacity-50');
                }
            }
        }
        
        // 방화문 타입 변경 시 자동 옵션 선택
        // 람바/소대 체크박스 이벤트 리스너
        const lambaCheckbox = document.querySelector('[name="frameExtraOptions"][value="lamba"]');
        if (lambaCheckbox) {
            lambaCheckbox.addEventListener('change', function(e) {
                if (this.checked) {
                    // 람마 모달 열기
                    openLambaModal();
                } else {
                    updateSteelPlateInputs();
                }
            });
        }
        
        // 소대 체크박스 이벤트 리스너
        const smallPlatformCheckbox = document.querySelector('[name="frameExtraOptions"][value="smallPlatform"]');
        if (smallPlatformCheckbox) {
            smallPlatformCheckbox.addEventListener('change', function(e) {
                if (this.checked) {
                    // 소대 모달 열기
                    openSmallPlatformModal();
                } else {
                    updateSteelPlateInputs();
                }
            });
        }
        
        // 철판막음 입력란 이벤트 리스너
        for (let i = 1; i <= 3; i++) {
            const widthInput = document.getElementById(`steelPlate${i}Width`);
            const heightInput = document.getElementById(`steelPlate${i}Height`);
            
            if (widthInput && heightInput) {
                widthInput.addEventListener('input', () => enableSteelPlateRadios(i));
                heightInput.addEventListener('input', () => enableSteelPlateRadios(i));
                widthInput.addEventListener('blur', () => enableSteelPlateRadios(i));
                heightInput.addEventListener('blur', () => enableSteelPlateRadios(i));
                
                // 라디오 버튼 변경 시 자동 계산
                const baseRadio = document.querySelector(`[name="steelPlate${i}Type"][value="base"]`);
                const singleRadio = document.querySelector(`[name="steelPlate${i}Type"][value="single"]`);
                const doubleRadio = document.querySelector(`[name="steelPlate${i}Type"][value="double"]`);
                
                if (baseRadio) {
                    baseRadio.addEventListener('change', () => {
                        console.log(`📊 철판막음${i} - 양면철판 선택 → 자동 계산 실행`);
                        document.getElementById('calculatorForm')?.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
                    });
                }
                if (singleRadio) {
                    singleRadio.addEventListener('change', () => {
                        console.log(`📊 철판막음${i} - 양면철판+일면칼라 선택 → 자동 계산 실행`);
                        document.getElementById('calculatorForm')?.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
                    });
                }
                if (doubleRadio) {
                    doubleRadio.addEventListener('change', () => {
                        console.log(`📊 철판막음${i} - 양면철판+양면칼라 선택 → 자동 계산 실행`);
                        document.getElementById('calculatorForm')?.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
                    });
                }
            }
        }
        
        // 초기 상태 설정
        updateSteelPlateInputs();
    </script>
    
    <script>
        // ============================================
        // 람마 모달 관련 함수
        // ============================================
        
        // 람마 모달 열기
        function openLambaModal() {
            const frameWidth = parseInt(document.getElementById('frameWidth').value) || 1000;
            const frameHeight = parseInt(document.getElementById('frameHeight').value) || 2100;
            
            // 현재 문틀 규격 표시
            document.getElementById('lamba_modal_frameWidth').textContent = frameWidth + 'mm';
            document.getElementById('lamba_modal_frameHeight').textContent = frameHeight + 'mm';
            
            // 입력 필드 초기화
            document.getElementById('lambaModalInput').value = '2030';
            
            // 미리보기 숨김
            document.getElementById('lambaCalcPreview').style.display = 'none';
            
            // 모달 표시
            document.getElementById('lambaModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // 입력 필드에 포커스
            setTimeout(() => {
                document.getElementById('lambaModalInput').focus();
                document.getElementById('lambaModalInput').select();
            }, 100);
        }
        
        // 람마 모달 닫기
        function closeLambaModal() {
            document.getElementById('lambaModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // 람마 체크 해제
            const lambaCheckbox = document.querySelector('[name="frameExtraOptions"][value="lamba"]');
            if (lambaCheckbox) {
                lambaCheckbox.checked = false;
            }
        }
        
        // 람마 값 적용
        function applyLambaValue() {
            const doorGapInput = document.getElementById('lambaModalInput').value;
            
            if (!doorGapInput || doorGapInput.trim() === '') {
                alert('⚠️ 문짝 치수(세로)를 입력해주세요.');
                document.getElementById('lambaModalInput').focus();
                return;
            }
            
            const doorGap = parseInt(doorGapInput);
            
            if (isNaN(doorGap) || doorGap <= 0) {
                alert('⚠️ 유효한 숫자를 입력해주세요.');
                document.getElementById('lambaModalInput').focus();
                return;
            }
            
            const frameHeight = parseInt(document.getElementById('frameHeight').value) || 2100;
            
            // 문짝 세로 = 입력값 그대로 적용
            const doorHeightValue = doorGap;
            
            // 문짝 세로 필드에 입력
            const doorHeightField = document.getElementById('doorHeight');
            if (doorHeightField) {
                doorHeightField.value = doorHeightValue;
                console.log(`✅ 문짝 세로 적용: ${doorHeightValue}mm`);
            }
            
            // 모달 닫기
            document.getElementById('lambaModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // 철판막음 입력란 활성화
            updateSteelPlateInputs();
            
            // 성공 메시지
            console.log(`✅ 람마 설정 완료: 문짝 세로 = ${doorHeightValue}mm`);
        }
        
        // 옵션 목록 동적 로딩
        let availableOptions = { frame: [], door: [] };
        
        async function loadAvailableOptions() {
            try {
                console.log('📥 추가옵션 목록 로딩 시작...');
                const response = await axios.get('api/settings/option-pricing');
                
                if (response.data.success && response.data.options) {
                    const options = response.data.options;
                    
                    // 활성화된 옵션만 필터링하고 섹션별로 분류
                    availableOptions.frame = options
                        .filter(opt => opt.section === 'frame' && opt.is_active)
                        .sort((a, b) => a.display_order - b.display_order);
                    
                    availableOptions.door = options
                        .filter(opt => opt.section === 'door' && opt.is_active)
                        .sort((a, b) => a.display_order - b.display_order);
                    
                    console.log('✅ 옵션 로딩 완료:', {
                        frame: availableOptions.frame.length,
                        door: availableOptions.door.length
                    });
                    
                    // 옵션 UI 렌더링
                    renderFrameOptions();
                    renderDoorOptions();
                } else {
                    console.error('❌ 옵션 로딩 실패:', response.data);
                }
            } catch (error) {
                console.error('❌ 옵션 로딩 에러:', error);
                // 에러 시 기본 옵션 사용
                useDefaultOptions();
            }
        }
        
        // 기본 옵션 (API 실패 시 폴백)
        function useDefaultOptions() {
            availableOptions.frame = [
                { option_key: 'hinge', option_label: '경첩' },
                { option_key: 'mortiseLock', option_label: '모티스락' },
                { option_key: 'glassWool', option_label: '글라스울' },
                { option_key: 'condensationHole', option_label: '결로타공' },
                { option_key: 'firePin', option_label: '방화핀' },
                { option_key: 'lamba', option_label: '람바' },
                { option_key: 'smallPlatform', option_label: '소대' },
                { option_key: 'sealCover', option_label: '실커버' },
                { option_key: 'mortarJoint', option_label: '몰탈사춤' }
            ];
            
            availableOptions.door = [
                { option_key: 'mineralWool', option_label: '미네랄울' },
                { option_key: 'mortiseLock', option_label: '모티스락' },
                { option_key: 'fireCap', option_label: '방화캡' },
                { option_key: 'visionPanelSmall', option_label: '견시창01' },
                { option_key: 'visionPanelLarge', option_label: '견시창02' },
                { option_key: 'pfBoard', option_label: 'PF보드' }
            ];
            
            renderFrameOptions();
            renderDoorOptions();
        }
        
        // 문틀 옵션 렌더링
        function renderFrameOptions() {
            const container = document.querySelector('.frame-extra-options-section .grid');
            if (!container) return;
            
            container.innerHTML = availableOptions.frame.map(option => `
                <label class="custom-checkbox">
                    <input type="checkbox" name="frameExtraOptions" value="${option.option_key}">
                    <div class="checkbox-label">
                        <div class="checkbox-icon"></div>
                        <span>${option.option_label}</span>
                    </div>
                </label>
            `).join('');
            
            // 체크박스 변경 시 실시간 계산
            container.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    console.log(`🔄 문틀 옵션 변경: ${this.value} = ${this.checked}`);
                    if (typeof calculatePrice === 'function') {
                        calculatePrice();
                    }
                });
            });
            
            console.log(`✅ 문틀 옵션 렌더링 완료: ${availableOptions.frame.length}개 (이벤트 연결됨)`);
        }
        
        // 문짝 옵션 렌더링
        function renderDoorOptions() {
            const container = document.querySelector('.door-extra-options-section .grid');
            if (!container) return;
            
            container.innerHTML = availableOptions.door.map(option => `
                <label class="custom-checkbox">
                    <input type="checkbox" name="doorExtraOptions" value="${option.option_key}">
                    <div class="checkbox-label">
                        <div class="checkbox-icon"></div>
                        <span>${option.option_label}</span>
                    </div>
                </label>
            `).join('');
            
            // 체크박스 변경 시 실시간 계산
            container.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    console.log(`🔄 문짝 옵션 변경: ${this.value} = ${this.checked}`);
                    if (typeof calculatePrice === 'function') {
                        calculatePrice();
                    }
                });
            });
            
            console.log(`✅ 문짝 옵션 렌더링 완료: ${availableOptions.door.length}개 (이벤트 연결됨)`);
        }

        // 람마 모달 입력 시 실시간 계산 미리보기
        document.addEventListener('DOMContentLoaded', function() {
            // 옵션 로딩
            loadAvailableOptions();
            
            const lambaInput = document.getElementById('lambaModalInput');
            if (lambaInput) {
                lambaInput.addEventListener('input', function() {
                    const doorGap = parseInt(this.value);
                    const frameHeight = parseInt(document.getElementById('frameHeight').value) || 2100;
                    
                    if (!isNaN(doorGap) && doorGap > 0) {
                        const calculatedDoorHeight = doorGap;  // 입력값 그대로
                        
                        document.getElementById('lambaCalcResult').textContent = calculatedDoorHeight + 'mm';
                        document.getElementById('lambaCalcFormula').textContent = `입력값 그대로: ${doorGap}mm`;
                        document.getElementById('lambaCalcPreview').style.display = 'block';
                    } else {
                        document.getElementById('lambaCalcPreview').style.display = 'none';
                    }
                });
                
                // Enter 키로 적용
                lambaInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applyLambaValue();
                    }
                });
            }
        });
    </script>
    
    <div id="quotationItemsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- 모달 헤더 -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-clipboard-list text-2xl"></i>
                    <h2 class="text-2xl font-bold">견적 품목 관리</h2>
                </div>
                <button onclick="closeQuotationItemsModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 모달 바디 -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- 문틀/문짝 섹션 -->
                <div class="mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-4 py-2 rounded-t-xl flex items-center justify-between">
                        <h3 class="font-bold flex items-center">
                            <i class="fas fa-door-closed mr-2"></i>문틀/문짝 품목
                        </h3>
                        <span id="doorItemsCount" class="text-sm">0개</span>
                    </div>
                    <div id="modalDoorItemsList">
                        <!-- 동적으로 로드됨 -->
                        <div class="text-center py-8 text-gray-400 text-sm border-x border-b rounded-b-xl">
                            등록된 품목이 없습니다
                        </div>
                    </div>
                </div>
                
                <!-- 하드웨어 섹션 -->
                <div>
                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-4 py-2 rounded-t-xl flex items-center justify-between">
                        <h3 class="font-bold flex items-center">
                            <i class="fas fa-tools mr-2"></i>하드웨어 품목
                        </h3>
                        <div class="flex items-center gap-2">
                            <span id="hardwareItemsCount" class="text-sm">0개</span>
                            <button onclick="openHardwareModal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded px-3 py-1 text-xs transition">
                                <i class="fas fa-plus mr-1"></i>추가
                            </button>
                        </div>
                    </div>
                    <div id="modalHardwareItemsList">
                        <!-- 동적으로 로드됨 -->
                        <div class="text-center py-8 text-gray-400 text-sm border-x border-b rounded-b-xl">
                            등록된 품목이 없습니다
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="border-t p-6 bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-lg font-bold text-gray-700">
                        총 <span id="quotationItemsCount" class="text-blue-600">0</span>개 품목
                    </div>
                    <div class="text-2xl font-bold text-indigo-600">
                        합계: <span id="quotationTotalAmount">0</span>원
                    </div>
                </div>
                <div class="flex gap-3 justify-end">
                    <button onclick="closeQuotationItemsModal()" class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold transition">
                        닫기
                    </button>
                    <button onclick="clearAllQuotationItems()" class="px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition">
                        <i class="fas fa-trash mr-2"></i>전체 삭제
                    </button>
                    <button onclick="editQuotationInfo()" class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition">
                        <i class="fas fa-edit mr-2"></i>견적 조건 편집
                    </button>
                    <button onclick="openCreateQuotationModal()" class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-lg font-semibold transition">
                        <i class="fas fa-file-invoice mr-2"></i>견적서 생성
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 견적 품목 수정 모달 -->
    <div id="editQuotationItemModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
            <!-- 모달 헤더 -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 flex justify-between items-center rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <i class="fas fa-edit text-2xl"></i>
                    <h2 class="text-2xl font-bold">견적 품목 수정</h2>
                </div>
                <button onclick="closeEditQuotationItemModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 모달 바디 -->
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <input type="hidden" id="edit_item_id">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">품명</label>
                        <input type="text" id="edit_fire_door_type" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">수량</label>
                        <input type="number" id="edit_quantity" min="1" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문틀 가로 (mm)</label>
                        <input type="number" id="edit_frame_width" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문틀 세로 (mm)</label>
                        <input type="number" id="edit_frame_height" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문틀두께</label>
                        <input type="text" id="edit_frame_thickness_info" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문틀 가격</label>
                        <input type="text" id="edit_frame_price" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none" onkeyup="formatPriceInput(this)">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문짝 가격</label>
                        <input type="text" id="edit_door_price" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none" onkeyup="formatPriceInput(this)">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">하드웨어 가격</label>
                        <input type="text" id="edit_hardware_price" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none" onkeyup="formatPriceInput(this)">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문틀 도장비</label>
                        <input type="text" id="edit_frame_painting_price" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none" onkeyup="formatPriceInput(this)">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">문짝 도장비</label>
                        <input type="text" id="edit_door_painting_price" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none" onkeyup="formatPriceInput(this)">
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-bold text-gray-700 mb-2">특이사항</label>
                    <textarea id="edit_notes" rows="3" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-blue-500 focus:outline-none"></textarea>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="border-t p-6 bg-gray-50 rounded-b-2xl">
                <div class="flex gap-3 justify-end">
                    <button onclick="closeEditQuotationItemModal()" class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold transition">
                        취소
                    </button>
                    <button onclick="saveQuotationItem()" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-lg font-semibold transition">
                        <i class="fas fa-save mr-2"></i>저장
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 견적서 생성 모달 -->
    <div id="createQuotationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col">
            <!-- 모달 헤더 -->
            <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white p-6 flex justify-between items-center rounded-t-2xl">
                <div class="flex items-center gap-3">
                    <i class="fas fa-file-invoice text-2xl"></i>
                    <h2 id="quotationModalTitle" class="text-2xl font-bold">견적서 생성</h2>
                </div>
                <button onclick="closeCreateQuotationModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 폼 바디 (스크롤 가능) -->
            <div class="p-6 overflow-y-auto flex-1">
                <form id="createQuotationForm" class="grid grid-cols-2 gap-4">
                    <!-- 견적서 제목 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-heading text-blue-600 mr-1"></i>견적서 제목
                        </label>
                        <input type="text" id="quotation_title" value="방화문 견적서"
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none">
                    </div>
                    
                    <!-- 고객명 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-user text-blue-600 mr-1"></i>고객명
                        </label>
                        <input type="text" id="quotation_customer_name"
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                               placeholder="고객명 입력">
                    </div>
                    
                    <!-- 현장명 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-building text-blue-600 mr-1"></i>현장명
                        </label>
                        <input type="text" id="quotation_site_name"
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                               placeholder="현장명 입력">
                    </div>
                    
                    <!-- 연락처 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-phone text-blue-600 mr-1"></i>연락처
                        </label>
                        <input type="tel" id="quotation_customer_phone"
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none"
                               placeholder="010-0000-0000">
                    </div>
                    
                    <!-- 주소 (숨김) -->
                    <div style="display: none;">
                        <textarea id="quotation_customer_address" rows="2"></textarea>
                    </div>
                    
                    <!-- 견적조건 (전체 너비) -->
                    <div class="col-span-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-clipboard-list text-blue-600 mr-1"></i>견적조건
                        </label>
                        <textarea id="quotation_conditions" rows="4"
                                  class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none">*분체도장: 블랙 또는 특수색상은 추가금이 있습니다.
*일반 피봇힌지 / 일반 방화문손잡이타공 / 도어40T
*하드웨어 별도 / 실커버 별도 / 몰탈사춤 별도 / 운임비 별도</textarea>
                    </div>
                    
                    <!-- 비고 (전체 너비) -->
                    <div class="col-span-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-comment text-blue-600 mr-1"></i>비고
                        </label>
                        <textarea id="quotation_notes" rows="4"
                                  class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none">계약금 30%입금 후 제작 가능합니다.
계약금 미입금시 주문접수는 안되오니 참고 부탁드립니다.
후레임 출고 시 30%, 도어 출고시 잔금 완불 후 출고되오니 참고 부탁드립니다.</textarea>
                    </div>
                    
                    <!-- 계좌번호 -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-credit-card text-blue-600 mr-1"></i>계좌번호
                        </label>
                        <input type="text" id="quotation_account" 
                               value="입금계좌: 기업은행 361-096546-04-019 (주)정일방화문"
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none">
                    </div>
                    
                    <!-- 담당자 -->
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-2">
                            <i class="fas fa-user text-blue-600 mr-1"></i>담당자
                        </label>
                        <input type="text" id="quotation_manager" 
                               value="손효은"
                               placeholder="담당자명"
                               class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-green-500 focus:outline-none">
                    </div>
                </form>
            </div>
            
            <!-- 폼 푸터 -->
            <div class="border-t p-6 flex justify-end gap-3 bg-gray-50">
                <button onclick="closeCreateQuotationModal()" class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold transition">
                    취소
                </button>
                <button id="quotationSubmitBtn" onclick="createQuotation()" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition">
                    <i class="fas fa-check mr-2"></i>견적서 생성
                </button>
            </div>
        </div>
    </div>
    
    <!-- 견적서 목록 모달 -->
    <div id="quotationListModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- 모달 헤더 -->
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white p-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-folder-open text-2xl"></i>
                    <h2 class="text-2xl font-bold">견적서 목록</h2>
                </div>
                <button onclick="closeQuotationListModal()" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- 모달 바디 -->
            <div class="flex-1 overflow-y-auto p-6">
                <div id="quotationList">
                    <!-- 동적으로 로드됨 -->
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                        <p class="text-lg">로딩 중...</p>
                    </div>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="border-t p-4 bg-gray-50 flex justify-end">
                <button onclick="closeQuotationListModal()" class="px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold transition">
                    닫기
                </button>
            </div>
        </div>
    </div>
    
    <!-- 분체도장 모달 -->
    <div id="powderCoatingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-7xl h-[90vh] flex flex-col">
            <!-- 모달 헤더 -->
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-paint-brush mr-2 text-green-600"></i>
                    분체도장 관리
                </h2>
                <button onclick="closePowderCoatingModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 모달 본문 (iframe) -->
            <div class="flex-1 overflow-hidden">
                <iframe id="powderCoatingIframe" class="w-full h-full border-0"></iframe>
            </div>
        </div>
    </div>
    
    <!-- 람마 문짝 치수 입력 모달 -->
    <div id="lambaModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="max-width: 500px;">
            <!-- 모달 헤더 -->
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-ruler-vertical mr-2"></i>
                    문짝 치수(세로) 입력
                </h2>
                <button type="button" onclick="closeLambaModal()" class="modal-close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 모달 내용 -->
            <div class="modal-content" style="padding: 24px;">
                <!-- 안내 문구 -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                        <div class="text-sm text-blue-700">
                            <p class="font-semibold mb-2">문짝치수 입력안내</p>
                            <p>문짝치수를 입력하세요.</p>
                            <p class="mt-2">
                                <span class="font-mono bg-white px-2 py-1 rounded">
                                    후렘외경-문짝치수-100= 람마내경
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- 현재 문틀 규격 표시 -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="text-xs text-gray-600 mb-2">현재 문틀 규격</div>
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="text-sm text-gray-500">가로:</span>
                            <span id="lamba_modal_frameWidth" class="text-lg font-bold ml-2">1000mm</span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">세로:</span>
                            <span id="lamba_modal_frameHeight" class="text-lg font-bold ml-2">2100mm</span>
                        </div>
                    </div>
                </div>
                
                <!-- 입력 필드 -->
                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        문짝 치수(세로) <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input 
                            type="number" 
                            id="lambaModalInput" 
                            class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200" 
                            placeholder="예: 70"
                            min="10"
                            max="500"
                            step="1"
                        >
                        <span class="absolute right-4 top-3 text-lg text-gray-500">mm</span>
                    </div>

                </div>
                
                <!-- 계산 결과 미리보기 -->
                <div id="lambaCalcPreview" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6" style="display: none;">
                    <div class="text-xs text-green-600 font-semibold mb-2">
                        <i class="fas fa-calculator mr-1"></i>
                        계산 결과 미리보기
                    </div>
                    <div class="text-sm text-gray-700">
                        <div class="mb-2">
                            <span class="text-gray-600">문짝 세로:</span>
                            <span id="lambaCalcResult" class="text-xl font-bold text-green-700 ml-2">-</span>
                        </div>
                        <div class="text-xs text-gray-500 font-mono bg-white px-2 py-1 rounded">
                            계산식: <span id="lambaCalcFormula">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="modal-footer">
                <button type="button" onclick="closeLambaModal()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                    <i class="fas fa-times mr-2"></i>
                    취소
                </button>
                <button type="button" onclick="applyLambaValue()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-check mr-2"></i>
                    적용하기
                </button>
            </div>
        </div>
    </div>
    
    <!-- 소대 모달 -->
    <div id="smallPlatformModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="max-width: 500px;">
            <!-- 모달 헤더 -->
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-ruler-horizontal mr-2"></i>
                    소대 설정
                </h2>
                <button type="button" class="modal-close-btn" onclick="closeSmallPlatformModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 모달 본문 -->
            <div class="modal-content" style="padding: 24px;">
                <!-- 안내 문구 -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                        <div class="text-sm text-blue-700">
                            <p class="font-semibold mb-2">문짝치수 입력안내</p>
                            <p>문짝치수(가로)를 입력하세요.</p>
                        </div>
                    </div>
                </div>
                
                <!-- 현재 문틀 규격 표시 -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="text-xs text-gray-600 mb-2">현재 문틀 규격</div>
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="text-sm text-gray-500">가로:</span>
                            <span id="smallPlatform_modal_frameWidth" class="text-lg font-bold ml-2">1000mm</span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">세로:</span>
                            <span id="smallPlatform_modal_frameHeight" class="text-lg font-bold ml-2">2100mm</span>
                        </div>
                    </div>
                </div>
                
                <!-- 입력 필드 -->
                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        문짝 치수(가로) <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input 
                            type="number" 
                            id="smallPlatformModalInput" 
                            class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200" 
                            placeholder="예: 930"
                            min="10"
                            max="5000"
                            step="1"
                        >
                        <span class="absolute right-4 top-3 text-lg text-gray-500">mm</span>
                    </div>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="modal-footer">
                <button type="button" onclick="closeSmallPlatformModal()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                    <i class="fas fa-times mr-2"></i>
                    취소
                </button>
                <button type="button" onclick="applySmallPlatformValue()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-check mr-2"></i>
                    적용하기
                </button>
            </div>
        </div>
    </div>
    
    <!-- 철판막음 모달 -->
    <div id="steelPlateModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <!-- 모달 헤더 -->
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-layer-group mr-2"></i>
                    철판막음 설정
                </h2>
                <button type="button" class="modal-close-btn" onclick="closeSteelPlateModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 모달 본문 -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- 철판막음 안내 -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                        <div class="flex-1">
                            <h3 class="text-sm font-semibold text-blue-900 mb-1">철판막음 설정 방법</h3>
                            <ul class="text-xs text-blue-800 space-y-1">
                                <li>• 문틀 규격을 먼저 입력하면 철판막음을 추가할 수 있습니다</li>
                                <li>• 최대 2개까지 추가 가능하며, 각각 다른 규격과 옵션을 선택할 수 있습니다</li>
                                <li>• 옵션별 가격: 양면철판 (30,000원), 양면철판+일면칼라 (75,000원), 양면철판+양면칼라 (105,000원)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- 철판막음 1, 2 (가로 2열 배치) -->
                <div class="grid grid-cols-2 gap-4">
                    <!-- 철판막음1 -->
                    <div class="steel-plate-item">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-bold text-gray-800">
                                <i class="fas fa-square text-indigo-600 mr-2"></i>
                                철판막음 1
                            </h3>
                            <span id="modal_steelPlate1_status" class="text-xs text-gray-500">비활성화</span>
                        </div>
                        
                        <!-- 규격 입력 -->
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">가로 (mm)</label>
                                <input type="number" id="modal_steelPlate1Width" class="w-full px-3 py-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="가로" disabled>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">세로 (mm)</label>
                                <input type="number" id="modal_steelPlate1Height" class="w-full px-3 py-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="세로" disabled>
                            </div>
                        </div>
                        
                        <!-- 옵션 선택 -->
                        <div class="space-y-2">
                            <label class="block text-xs font-medium text-gray-700 mb-2">옵션 선택</label>
                            <div class="space-y-2">
                                <label class="modal-radio-option">
                                    <input type="radio" name="modal_steelPlate1Type" value="base" class="peer hidden" disabled>
                                    <div class="modal-radio-card peer-checked:active">
                                        <i class="fas fa-square text-lg text-indigo-600"></i>
                                        <div>
                                            <div class="font-semibold text-sm">양면철판</div>
                                            <div class="text-xs text-gray-600">기준: 30,000원</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="modal-radio-option">
                                    <input type="radio" name="modal_steelPlate1Type" value="single" class="peer hidden" disabled>
                                    <div class="modal-radio-card peer-checked:active">
                                        <i class="fas fa-layer-group text-lg text-indigo-600"></i>
                                        <div>
                                            <div class="font-semibold text-sm">양면철판 + 일면칼라</div>
                                            <div class="text-xs text-gray-600">기준: 75,000원</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="modal-radio-option">
                                    <input type="radio" name="modal_steelPlate1Type" value="double" class="peer hidden" disabled>
                                    <div class="modal-radio-card peer-checked:active">
                                        <i class="fas fa-th-large text-lg text-indigo-600"></i>
                                        <div>
                                            <div class="font-semibold text-sm">양면철판 + 양면칼라</div>
                                            <div class="text-xs text-gray-600">기준: 105,000원</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 철판막음2 -->
                    <div id="modal_steelPlate2Container" class="steel-plate-item">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-bold text-gray-800">
                                <i class="fas fa-square text-indigo-600 mr-2"></i>
                                철판막음 2
                            </h3>
                        </div>
                        
                        <!-- 규격 입력 -->
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">가로 (mm)</label>
                                <input type="number" id="modal_steelPlate2Width" class="w-full px-3 py-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="가로">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">세로 (mm)</label>
                                <input type="number" id="modal_steelPlate2Height" class="w-full px-3 py-2 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="세로">
                            </div>
                        </div>
                        
                        <!-- 옵션 선택 -->
                        <div class="space-y-2">
                            <label class="block text-xs font-medium text-gray-700 mb-2">옵션 선택</label>
                            <div class="space-y-2">
                                <label class="modal-radio-option">
                                    <input type="radio" name="modal_steelPlate2Type" value="base" class="peer hidden">
                                    <div class="modal-radio-card peer-checked:active">
                                        <i class="fas fa-square text-lg text-indigo-600"></i>
                                        <div>
                                            <div class="font-semibold text-sm">양면철판</div>
                                            <div class="text-xs text-gray-600">기준: 30,000원</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="modal-radio-option">
                                    <input type="radio" name="modal_steelPlate2Type" value="single" class="peer hidden">
                                    <div class="modal-radio-card peer-checked:active">
                                        <i class="fas fa-layer-group text-lg text-indigo-600"></i>
                                        <div>
                                            <div class="font-semibold text-sm">양면철판 + 일면칼라</div>
                                            <div class="text-xs text-gray-600">기준: 75,000원</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="modal-radio-option">
                                    <input type="radio" name="modal_steelPlate2Type" value="double" class="peer hidden">
                                    <div class="modal-radio-card peer-checked:active">
                                        <i class="fas fa-th-large text-lg text-indigo-600"></i>
                                        <div>
                                            <div class="font-semibold text-sm">양면철판 + 양면칼라</div>
                                            <div class="text-xs text-gray-600">기준: 105,000원</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 모달 푸터 -->
            <div class="modal-footer">
                <button type="button" class="modal-btn-secondary" onclick="closeSteelPlateModal()">
                    <i class="fas fa-times mr-2"></i>
                    취소
                </button>
                <button type="button" class="modal-btn-primary" onclick="applySteelPlateSettings()">
                    <i class="fas fa-check mr-2"></i>
                    적용하기
                </button>
            </div>
        </div>
    </div>
    <script>
        // ============================================
        // 소대 모달 관련 함수
        // ============================================
        
        // 소대 모달 열기
        function openSmallPlatformModal() {
            const frameWidth = parseInt(document.getElementById('frameWidth').value) || 1000;
            const frameHeight = parseInt(document.getElementById('frameHeight').value) || 2100;
            
            // 현재 문틀 규격 표시
            document.getElementById('smallPlatform_modal_frameWidth').textContent = frameWidth + 'mm';
            document.getElementById('smallPlatform_modal_frameHeight').textContent = frameHeight + 'mm';
            
            // 입력 필드 초기화
            document.getElementById('smallPlatformModalInput').value = '930';
            
            // 모달 표시
            document.getElementById('smallPlatformModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // 입력 필드에 포커스
            setTimeout(() => {
                document.getElementById('smallPlatformModalInput').focus();
                document.getElementById('smallPlatformModalInput').select();
            }, 100);
        }
        
        // 소대 모달 닫기
        function closeSmallPlatformModal() {
            document.getElementById('smallPlatformModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // 소대 체크 해제
            const smallPlatformCheckbox = document.querySelector('[name="frameExtraOptions"][value="smallPlatform"]');
            if (smallPlatformCheckbox) {
                smallPlatformCheckbox.checked = false;
            }
        }
        
        // 소대 값 적용
        function applySmallPlatformValue() {
            const doorWidthInput = document.getElementById('smallPlatformModalInput').value;
            
            if (!doorWidthInput || doorWidthInput.trim() === '') {
                alert('⚠️ 문짝 치수(가로)를 입력해주세요.');
                document.getElementById('smallPlatformModalInput').focus();
                return;
            }
            
            const doorWidth = parseInt(doorWidthInput);
            
            if (isNaN(doorWidth) || doorWidth <= 0) {
                alert('⚠️ 유효한 숫자를 입력해주세요.');
                document.getElementById('smallPlatformModalInput').focus();
                return;
            }
            
            // 문짝 가로 필드에 입력값 그대로 적용
            const doorWidthField = document.getElementById('doorWidth');
            if (doorWidthField) {
                doorWidthField.value = doorWidth;
                console.log(`✅ 문짝 가로 적용: ${doorWidth}mm`);
            }
            
            // 모달 닫기
            document.getElementById('smallPlatformModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // 철판막음 입력란 활성화
            updateSteelPlateInputs();
            
            // 성공 메시지
            console.log(`✅ 소대 설정 완료: 문짝 가로 = ${doorWidth}mm`);
        }
        
        // Enter 키로 적용
        document.addEventListener('DOMContentLoaded', function() {
            const smallPlatformInput = document.getElementById('smallPlatformModalInput');
            if (smallPlatformInput) {
                smallPlatformInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applySmallPlatformValue();
                    }
                });
            }
        });
        
        // 엑셀 내보내기 함수
        async function exportToExcel() {
            // 계산 먼저 실행
            if (typeof calculatePrice === 'function') {
                await calculatePrice();
            }
            
            // 현재 입력된 데이터 수집
            const formData = new FormData(document.getElementById('calculatorForm'));
            
            // 방화문 타입
            const fireDoorType = formData.get('fireDoorType') || 'sd';
            const fireDoorTypeMap = {
                'sd': 'SD',
                'sd-insulated': 'SD',
                'sd-insulated-eu': 'SD',
                'fsd': 'FSD',
                'panel-1.2t': 'SD[판넬용]',
                'certified': '인증방화문',
                'pig-barn': '돈사도어(SUS304)'
            };
            
            // 문틀 규격
            const frameWidth = formData.get('frameWidth') || '';
            const frameHeight = formData.get('frameHeight') || '';
            const frameThickness = formData.get('frameThickness') || '';
            const thicknessType = formData.get('thicknessType') || 'bar';
            const frameOption = formData.get('frameOption') || '';
            
            // 하단 표시
            const thicknessTypeText = thicknessType === 'bar' ? '바' : 'T';
            const frameOptionText = frameOption === 'hasten30' ? '하스텐(30)' : 
                                   frameOption === 'hasten10' ? '하스텐(10)' : 
                                   frameOption === 'steelBottom' ? '철판하단' : 
                                   frameOption === 'threeSides' ? '삼면틀' : '';
            const bottomText = `${frameThickness}${thicknessTypeText}/${frameOptionText}`;
            
            // 문짝 종류
            const doorMaterial = formData.get('doorMaterial') || 'egi';
            
            // 단가 정보 (전역 변수에서 가져오기)
            const frameTotalPrice = window.lastCalculation?.frameTotalPrice || 0;
            const doorTotalPrice = window.lastCalculation?.doorTotalPrice || 0;
            const framePaintingCost = parseInt(formData.get('framePaintingCost')) || 0;
            const doorPaintingCost = parseInt(formData.get('doorPaintingCost')) || 0;
            const hardwareTotalPrice = window.lastCalculation?.hardwareTotalPrice || 0;
            
            // 합계금액
            const totalPrice = frameTotalPrice + doorTotalPrice + framePaintingCost + doorPaintingCost + hardwareTotalPrice;
            
            // 특이사항 수집
            const notes = [];
            
            // 문틀 추가 옵션
            const frameExtraOptions = formData.getAll('frameExtraOptions');
            if (frameExtraOptions.length > 0) {
                const optionNames = {
                    'hinge': '경첩',
                    'mortiseLock': '모티스락',
                    'glassWool': '글라스울',
                    'condensationHole': '결로타공',
                    'firePin': '방화핀',
                    'lamba': '람마',
                    'smallPlatform': '소대',
                    'sealCover': '실커버',
                    'mortarJoint': '몰탈사춤',
                    'painting': '도장'
                };
                notes.push('문틀: ' + frameExtraOptions.map(opt => optionNames[opt] || opt).join(', '));
            }
            
            // 문짝 추가 옵션
            const doorExtraOptions = formData.getAll('doorExtraOptions');
            if (doorExtraOptions.length > 0) {
                const doorOptionNames = {
                    'glassWool': '글라스울',
                    'mineralWool': '미네랄울',
                    'mortiseLock': '모티스락',
                    'fireCap': '방화캡',
                    'firePin': '방화핀',
                    'visionPanelSmall': '견시창01',
                    'visionPanelLarge': '견시창02',
                    'painting': '도장'
                };
                notes.push('문짝: ' + doorExtraOptions.map(opt => doorOptionNames[opt] || opt).join(', '));
            }
            
            // 하드웨어
            const selectedHardware = Array.from(document.querySelectorAll('input[name="hardware"]:checked'))
                .map(cb => {
                    const label = cb.closest('label');
                    const nameEl = label?.querySelector('.text-sm.font-bold');
                    return nameEl ? nameEl.textContent : '';
                })
                .filter(name => name);
            
            if (selectedHardware.length > 0) {
                notes.push('하드웨어: ' + selectedHardware.join(', '));
            }
            
            const notesText = notes.join(' | ');
            
            // 엑셀 데이터 생성
            const excelData = [{
                '방화문타입': fireDoorTypeMap[fireDoorType] || fireDoorType.toUpperCase(),
                '후렘규격W': frameWidth,
                '후렘규격H': frameHeight,
                '후렘두께/하단': bottomText,
                '문틀단가': frameTotalPrice,
                '문짝단가': doorTotalPrice,
                '문틀도장단가': framePaintingCost,
                '문짝도장단가': doorPaintingCost,
                '하드웨어단가': hardwareTotalPrice,
                '합계금액': totalPrice,
                '수량': 1,
                '공급가액': totalPrice,
                '특이사항': notesText
            }];
            
            // 워크시트 생성
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // 열 너비 설정
            ws['!cols'] = [
                { wch: 15 },  // 방화문타입
                { wch: 12 },  // 후렘규격W
                { wch: 12 },  // 후렘규격H
                { wch: 20 },  // 후렘두께/하단
                { wch: 12 },  // 문틀단가
                { wch: 12 },  // 문짝단가
                { wch: 15 },  // 문틀도장단가
                { wch: 15 },  // 문짝도장단가
                { wch: 15 },  // 하드웨어단가
                { wch: 12 },  // 합계금액
                { wch: 8 },   // 수량
                { wch: 12 },  // 공급가액
                { wch: 60 }   // 특이사항
            ];
            
            // 워크북 생성
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '방화문 견적');
            
            // 파일명 생성 (날짜 포함)
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0].replace(/-/g, '');
            const filename = `방화문견적_${fireDoorTypeMap[fireDoorType]}_${frameWidth}x${frameHeight}_${dateStr}.xlsx`;
            
            // 파일 다운로드
            XLSX.writeFile(wb, filename);
            
            alert('엑셀 파일이 다운로드되었습니다.');
        }
        
        // 견적서 생성 함수
        async function generateQuotation() {
            // 계산 먼저 실행
            if (typeof calculatePrice === 'function') {
                await calculatePrice();
            }
            
            // 현재 입력된 데이터 수집
            const formData = new FormData(document.getElementById('calculatorForm'));
            
            // 방화문 타입
            const fireDoorType = formData.get('fireDoorType') || 'sd';
            const fireDoorTypeMap = {
                'sd': 'SD (일반방화문)',
                'fsd': 'FSD (방화문)',
                'panel-1.2t': '판넬용1.2T후렘'
            };
            
            // 문틀 규격
            const frameWidth = formData.get('frameWidth') || '';
            const frameHeight = formData.get('frameHeight') || '';
            const frameThickness = formData.get('frameThickness') || '';
            const thicknessType = formData.get('thicknessType') || 'bar';
            const frameOption = formData.get('frameOption') || '';
            
            // 문짝 규격
            const doorWidth = formData.get('doorWidth') || '';
            const doorHeight = formData.get('doorHeight') || '';
            const doorMaterial = formData.get('doorMaterial') || 'egi';
            const doorType = formData.get('doorType') || 'single';
            
            const doorMaterialMap = {
                'egi': 'EGI',
                'color': 'COLOR',
                'stainless': '스텐레스',
                'kamachi': '가마찌',
                'sliding': '슬라이딩'
            };
            
            const doorTypeMap = {
                'single': '편개',
                'double': '양개'
            };
            
            // 단가 정보
            const frameTotalPrice = window.lastCalculation?.frameTotalPrice || 0;
            const doorTotalPrice = window.lastCalculation?.doorTotalPrice || 0;
            const framePaintingCost = parseInt(formData.get('framePaintingCost')) || 0;
            const doorPaintingCost = parseInt(formData.get('doorPaintingCost')) || 0;
            const hardwareTotalPrice = window.lastCalculation?.hardwareTotalPrice || 0;
            
            // 합계금액
            const totalPrice = frameTotalPrice + doorTotalPrice + framePaintingCost + doorPaintingCost + hardwareTotalPrice;
            
            // 견적서 HTML 생성
            const quotationHTML = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방화문 견적서</title>
    <style>
        @media print {
            @page { margin: 20mm; }
            body { margin: 0; }
        }
        body {
            font-family: 'Malgun Gothic', sans-serif;
            padding: 40px;
            background: white;
        }
        .quotation-container {
            max-width: 800px;
            margin: 0 auto;
            border: 2px solid #333;
        }
        .header {
            background: #2563eb;
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 32px;
            font-weight: bold;
        }
        .header .date {
            margin-top: 10px;
            font-size: 14px;
        }
        .info-section {
            padding: 20px 30px;
            border-bottom: 1px solid #ddd;
        }
        .info-row {
            display: flex;
            padding: 8px 0;
        }
        .info-label {
            width: 150px;
            font-weight: bold;
            color: #555;
        }
        .info-value {
            flex: 1;
            color: #333;
        }
        .table-section {
            padding: 20px 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th {
            background: #f3f4f6;
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: bold;
            font-size: 13px;
        }
        td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 14px;
        }
        .text-right {
            text-align: right !important;
        }
        .text-left {
            text-align: left !important;
        }
        .total-row {
            background: #fef3c7;
            font-weight: bold;
            font-size: 16px;
        }
        .footer {
            padding: 20px 30px;
            border-top: 2px solid #333;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .print-button:hover {
            background: #059669;
        }
        @media print {
            .print-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">🖨️ 인쇄하기</button>
    
    <div class="quotation-container">
        <div class="header">
            <h1>방화문 견적서</h1>
            <div class="date">작성일: ${new Date().toLocaleDateString('ko-KR')}</div>
        </div>
        
        <div class="info-section">
            <h3 style="margin-top: 0; color: #2563eb;">기본 정보</h3>
            <div class="info-row">
                <div class="info-label">방화문 타입:</div>
                <div class="info-value">${fireDoorTypeMap[fireDoorType]}</div>
            </div>
            <div class="info-row">
                <div class="info-label">문틀 규격:</div>
                <div class="info-value">${frameWidth} × ${frameHeight} mm</div>
            </div>
            <div class="info-row">
                <div class="info-label">문틀 두께:</div>
                <div class="info-value">${frameThickness}${thicknessType === 'bar' ? 'mm (조적)' : 'T (판넬)'}</div>
            </div>
            <div class="info-row">
                <div class="info-label">문짝 규격:</div>
                <div class="info-value">${doorWidth} × ${doorHeight} mm</div>
            </div>
            <div class="info-row">
                <div class="info-label">문짝 종류:</div>
                <div class="info-value">${doorMaterialMap[doorMaterial]} / ${doorTypeMap[doorType]}</div>
            </div>
        </div>
        
        <div class="table-section">
            <h3 style="margin-top: 0; color: #2563eb;">상세 견적</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 40%;">항목</th>
                        <th style="width: 20%;">수량</th>
                        <th style="width: 20%;">단가</th>
                        <th style="width: 20%;">금액</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-left">문틀</td>
                        <td>1</td>
                        <td class="text-right">${frameTotalPrice.toLocaleString()}원</td>
                        <td class="text-right">${frameTotalPrice.toLocaleString()}원</td>
                    </tr>
                    <tr>
                        <td class="text-left">문짝</td>
                        <td>1</td>
                        <td class="text-right">${doorTotalPrice.toLocaleString()}원</td>
                        <td class="text-right">${doorTotalPrice.toLocaleString()}원</td>
                    </tr>
                    ${framePaintingCost > 0 ? `
                    <tr>
                        <td class="text-left">문틀 도장</td>
                        <td>1</td>
                        <td class="text-right">${framePaintingCost.toLocaleString()}원</td>
                        <td class="text-right">${framePaintingCost.toLocaleString()}원</td>
                    </tr>
                    ` : ''}
                    ${doorPaintingCost > 0 ? `
                    <tr>
                        <td class="text-left">문짝 도장</td>
                        <td>1</td>
                        <td class="text-right">${doorPaintingCost.toLocaleString()}원</td>
                        <td class="text-right">${doorPaintingCost.toLocaleString()}원</td>
                    </tr>
                    ` : ''}
                    ${hardwareTotalPrice > 0 ? `
                    <tr>
                        <td class="text-left">하드웨어</td>
                        <td>1</td>
                        <td class="text-right">${hardwareTotalPrice.toLocaleString()}원</td>
                        <td class="text-right">${hardwareTotalPrice.toLocaleString()}원</td>
                    </tr>
                    ` : ''}
                    <tr class="total-row">
                        <td colspan="3" class="text-right">합계 금액</td>
                        <td class="text-right">${totalPrice.toLocaleString()}원</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            <p>본 견적서는 견적 당시 기준으로 작성되었으며, 실제 시공 시 변경될 수 있습니다.</p>
            <p>문의사항이 있으시면 언제든지 연락 주시기 바랍니다.</p>
        </div>
    </div>
</body>
</html>
            `;
            
            // 새 창에서 견적서 열기
            const quotationWindow = window.open('', '_blank', 'width=900,height=800');
            quotationWindow.document.write(quotationHTML);
            quotationWindow.document.close();
        }
        
        // ==================== 견적 관리 함수 ====================
        
        // HTML 이스케이프 함수
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 견적에 추가
        async function addToQuotation() {
            console.log('🚀 addToQuotation 시작');
            console.log('🎯 currentQuotationId:', currentQuotationId);
            console.log('🎯 typeof currentQuotationId:', typeof currentQuotationId);
            
            // 섹션 활성화 상태 확인 (calculatePrice 호출 전에)
            const frameEnabled = document.getElementById('frameEnableCheckbox').checked;
            const doorEnabled = document.getElementById('doorEnableCheckbox').checked;
            const hardwareEnabled = document.getElementById('hardwareEnableCheckbox').checked;
            
            console.log('📋 섹션 활성화 상태:', { frameEnabled, doorEnabled, hardwareEnabled });
            
            // 하드웨어 정보 먼저 수집 (전역 변수 selectedHardwareCodes 사용)
            const selectedHardwareBeforeCalc = [];
            if (window.selectedHardwareCodes && window.selectedHardwareCodes.length > 0) {
                // 전역 변수에서 하드웨어 코드 가져오기
                window.selectedHardwareCodes.forEach(code => {
                    const hardwareData = window.hardwareDB ? window.hardwareDB.find(item => item.code === code) : null;
                    if (hardwareData) {
                        selectedHardwareBeforeCalc.push(hardwareData.name);
                    }
                });
            }
            
            console.log('🔧 calculatePrice 호출 전 선택된 하드웨어:', selectedHardwareBeforeCalc);
            console.log('🔧 selectedHardwareCodes:', window.selectedHardwareCodes);
            
            // 계산 먼저 실행
            if (typeof calculatePrice === 'function') {
                await calculatePrice();
                
                // calculatePrice 완료 후 잠시 대기 (displayResult 실행 완료 보장)
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // lastCalculation 검증
            if (!window.lastCalculation || window.lastCalculation.frameTotalPrice === undefined) {
                alert('⚠️ 먼저 견적을 계산해주세요.');
                console.error('❌ window.lastCalculation이 설정되지 않았습니다:', window.lastCalculation);
                return;
            }
            
            // 현재 입력된 데이터 수집
            const formData = new FormData(document.getElementById('calculatorForm'));
            
            // 방화문 타입
            const fireDoorType = formData.get('fireDoorType') || 'sd';
            const fireDoorTypeMap = {
                'sd': 'SD',
                'sd-insulated': 'SD',
                'sd-insulated-eu': 'SD',
                'fsd': 'FSD',
                'panel-1.2t': 'SD[판넬용]',
                'certified': '인증방화문',
                'pig-barn': '돈사도어(SUS304)'
            };
            
            // 문틀 규격
            const frameWidth = formData.get('frameWidth') || '';
            const frameHeight = formData.get('frameHeight') || '';
            const frameThickness = formData.get('frameThickness') || '';
            const thicknessType = formData.get('thicknessType') || 'bar';
            const frameOption = formData.get('frameOption') || '';
            
            // 하단 표시
            const thicknessTypeText = thicknessType === 'bar' ? '바' : 'T';
            
            // 판넬용1.2T 타입인 경우 panelBottomType 사용
            let frameThicknessInfo = '';
            if (fireDoorType === 'panel-1.2t') {
                const panelBottomType = formData.get('panelBottomType') || '삼면';
                frameThicknessInfo = `${frameThickness}T/${panelBottomType}`;
            } else {
                const frameOptionText = frameOption === 'hasten30' ? '하스텐(30)' : 
                                       frameOption === 'hasten10' ? '하스텐(10)' : 
                                       frameOption === 'steelBottom' ? '철판하단' : 
                                       frameOption === 'threeSides' ? '삼면틀' : '';
                frameThicknessInfo = `${frameThickness}${thicknessTypeText}/${frameOptionText}`;
            }
            
            // 단가 정보
            const frameTotalPrice = window.lastCalculation?.frameTotalPrice || 0;
            const doorTotalPrice = window.lastCalculation?.doorTotalPrice || 0;
            const framePaintingCost = parseInt(formData.get('framePaintingCost')) || 0;
            const doorPaintingCost = parseInt(formData.get('doorPaintingCost')) || 0;
            const hardwareTotalPrice = window.lastCalculation?.hardwareTotalPrice || 0;
            
            // 디버깅 로그
            console.log('💰 단가 정보:', {
                frameTotalPrice,
                doorTotalPrice,
                framePaintingCost,
                doorPaintingCost,
                hardwareTotalPrice,
                lastCalculation: window.lastCalculation
            });
            
            // 합계금액
            const totalPrice = frameTotalPrice + doorTotalPrice + framePaintingCost + doorPaintingCost + hardwareTotalPrice;
            
            // 특이사항 수집
            const notes = [];
            
            // COLOR 제품 product_code 추가
            const doorMaterial = formData.get('doorMaterial');
            if (doorMaterial === 'color' && window.lastCalculation?.colorProductCode) {
                notes.push('제품코드: ' + window.lastCalculation.colorProductCode);
            }
            
            // 문틀 추가 옵션
            const frameExtraOptions = formData.getAll('frameExtraOptions');
            if (frameExtraOptions.length > 0) {
                const optionNames = {
                    'hinge': '경첩', 'mortiseLock': '모티스락', 'glassWool': '글라스울',
                    'condensationHole': '결로타공', 'firePin': '방화핀', 'lamba': '람마',
                    'smallPlatform': '소대', 'sealCover': '실커버', 'mortarJoint': '몰탈사춤',
                    'painting': '도장'
                };
                notes.push('문틀: ' + frameExtraOptions.map(opt => optionNames[opt] || opt).join(', '));
            }
            
            // 문짝 추가 옵션
            const doorExtraOptions = formData.getAll('doorExtraOptions');
            if (doorExtraOptions.length > 0) {
                const doorOptionNames = {
                    'glassWool': '글라스울', 'mineralWool': '미네랄울', 'mortiseLock': '모티스락',
                    'fireCap': '방화캡', 'firePin': '방화핀', 'visionPanelSmall': '견시창01',
                    'visionPanelLarge': '견시창02', 'painting': '도장'
                };
                notes.push('문짝: ' + doorExtraOptions.map(opt => doorOptionNames[opt] || opt).join(', '));
            }
            
            // 하드웨어 (calculatePrice 호출 전에 저장한 값 사용)
            const selectedHardware = selectedHardwareBeforeCalc;
            
            console.log('🔧 최종 사용할 하드웨어:', selectedHardware);
            
            if (selectedHardware.length > 0) {
                notes.push('하드웨어: ' + selectedHardware.join(', '));
            }
            
            const notesText = notes.join(' | ');
            
            // 하드웨어만 활성화된 경우 품목명 설정
            let itemName = fireDoorTypeMap[fireDoorType] || fireDoorType;
            if (!frameEnabled && !doorEnabled && hardwareEnabled) {
                // 하드웨어만 활성화된 경우
                if (selectedHardware.length === 0) {
                    alert('⚠️ 하드웨어를 선택해주세요.');
                    return;
                }
                itemName = selectedHardware.join(', ');
                console.log('🔧 하드웨어 전용 품목:', itemName);
            }
            
            // fire_door_type 검증
            if (!itemName || itemName.trim() === '') {
                alert('⚠️ 품목명이 비어있습니다. 방화문 타입을 선택하거나 하드웨어를 선택해주세요.');
                console.error('❌ itemName이 비어있음:', { frameEnabled, doorEnabled, hardwareEnabled, selectedHardware });
                return;
            }
            
            console.log('✅ 최종 품목명:', itemName);
            
            // 로컬스토리지에 저장
            try {
                const itemData = {
                    fire_door_type: itemName,
                    frame_width: frameEnabled ? frameWidth : '',
                    frame_height: frameEnabled ? frameHeight : '',
                    frame_thickness_info: (frameEnabled || doorEnabled) ? frameThicknessInfo : '',
                    frame_price: frameTotalPrice,
                    door_price: doorTotalPrice,
                    frame_painting_price: framePaintingCost,
                    door_painting_price: doorPaintingCost,
                    hardware_price: hardwareTotalPrice,
                    total_price: totalPrice,
                    quantity: 1,
                    supply_price: totalPrice,
                    notes: notesText
                };
                
                console.log('💾 로컬스토리지에 저장:', itemData);
                
                // 로컬스토리지에 추가 (app.js의 함수 사용)
                const itemId = addToLocalQuotation(itemData);
                
                if (itemId) {
                    alert('견적에 추가되었습니다.');
                    // 견적 품목 개수 업데이트
                    updateQuotationItemsBadge();
                    // 추가된 품목 목록 업데이트
                    updateAddedItemsList();
                } else {
                    alert('오류: 로컬스토리지 저장 실패');
                }
            } catch (error) {
                console.error('견적 추가 실패:', error);
                alert('견적 추가 중 오류가 발생했습니다: ' + error.message);
            }
        }
        
        // window 객체에 명시적으로 추가 (app.js의 동적 HTML에서 사용)
        window.addToQuotation = addToQuotation;
        
        // 추가된 품목 목록 업데이트 (로컬스토리지에서 읽기)
        function updateAddedItemsList() {
            try {
                // 로컬스토리지에서 품목 조회 (app.js의 함수 사용)
                const items = getLocalQuotationItems();
                
                const section = document.getElementById('addedItemsSection');
                const doorList = document.getElementById('doorItemsList');
                const hardwareList = document.getElementById('hardwareItemsList');
                
                if (items.length === 0) {
                    section.style.display = 'none';
                    return;
                }
                
                // 품목을 문틀/문짝과 하드웨어로 분리
                const doorItems = items.filter(item => {
                    const hasFrame = (item.frame_price || 0) > 0;
                    const hasDoor = (item.door_price || 0) > 0;
                    const hasPainting = (item.frame_painting_price || 0) > 0 || (item.door_painting_price || 0) > 0;
                    return hasFrame || hasDoor || hasPainting;
                });
                
                const hardwareItems = items.filter(item => {
                    const hasFrame = (item.frame_price || 0) > 0;
                    const hasDoor = (item.door_price || 0) > 0;
                    const hasPainting = (item.frame_painting_price || 0) > 0 || (item.door_painting_price || 0) > 0;
                    const hasHardware = (item.hardware_price || 0) > 0;
                    return !hasFrame && !hasDoor && !hasPainting && hasHardware;
                });
                
                section.style.display = 'block';
                
                // 문틀/문짝 섹션 렌더링
                if (doorItems.length === 0) {
                    doorList.innerHTML = '<div class="text-center py-3 text-gray-400 text-xs">등록된 품목이 없습니다</div>';
                } else {
                    doorList.innerHTML = doorItems.map(item => {
                        const frameThickness = item.frame_thickness_info || '-';
                        const spec = item.frame_width && item.frame_height ? `${item.frame_width}×${item.frame_height}` : '-';
                        // 소숫점 제거
                        const framePrice = Math.floor(item.frame_price || 0).toLocaleString();
                            const doorPrice = Math.floor(item.door_price || 0).toLocaleString();
                            const framePainting = Math.floor(item.frame_painting_price || 0).toLocaleString();
                            const doorPainting = Math.floor(item.door_painting_price || 0).toLocaleString();
                            const totalPrice = Math.floor(item.total_price || 0).toLocaleString();
                            const supplyPrice = Math.floor(item.supply_price || 0).toLocaleString();
                            return `
                                <div class="border-b border-gray-100 last:border-0 py-2 text-[10px]">
                                    <div class="grid grid-cols-12 gap-1 items-center">
                                        <div class="col-span-1 font-semibold text-blue-700 truncate">${item.fire_door_type}</div>
                                        <div class="col-span-1 text-gray-600 text-[9px]">${spec}</div>
                                        <div class="col-span-1 text-gray-500 text-[9px] truncate">${frameThickness}</div>
                                        <div class="col-span-1 text-right text-blue-600">${framePrice}</div>
                                        <div class="col-span-1 text-right text-green-600">${doorPrice}</div>
                                        <div class="col-span-1 text-right text-purple-600">${framePainting}</div>
                                        <div class="col-span-1 text-right text-purple-600">${doorPainting}</div>
                                        <div class="col-span-1 text-right font-semibold text-gray-800">${totalPrice}</div>
                                        <div class="col-span-1 text-center text-gray-600">${item.quantity || 1}</div>
                                        <div class="col-span-1 text-right font-bold text-green-600">${supplyPrice}</div>
                                        <div class="col-span-2 text-gray-500 truncate text-[9px]" title="${item.notes || ''}">${item.notes || '-'}</div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    // 하드웨어 섹션 렌더링 (5개 필드: 품목, 수량, 단가, 공급가액, 특이사항)
                    if (hardwareItems.length === 0) {
                        hardwareList.innerHTML = '<div class="text-center py-3 text-gray-400 text-xs">등록된 품목이 없습니다</div>';
                    } else {
                        hardwareList.innerHTML = hardwareItems.map(item => {
                            // 소숫점 제거
                            const hardwarePrice = Math.floor(item.hardware_price || 0).toLocaleString();
                            const supplyPrice = Math.floor(item.supply_price || 0).toLocaleString();
                            return `
                                <div class="border-b border-gray-100 last:border-0 py-2 text-[10px]">
                                    <div class="grid grid-cols-12 gap-1 items-center">
                                        <div class="col-span-4 font-semibold text-orange-700 truncate">${item.fire_door_type}</div>
                                        <div class="col-span-1 text-center text-gray-600">${item.quantity || 1}</div>
                                        <div class="col-span-2 text-right text-orange-600">${hardwarePrice}</div>
                                        <div class="col-span-2 text-right font-bold text-green-600">${supplyPrice}</div>
                                        <div class="col-span-3 text-gray-500 truncate text-[9px]" title="${item.notes || ''}">${item.notes || '-'}</div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    // 소계 및 합계 계산 (소숫점 제거)
                    const doorSubtotal = Math.floor(doorItems.reduce((sum, item) => sum + (item.supply_price || 0), 0));
                    const hardwareSubtotal = Math.floor(hardwareItems.reduce((sum, item) => sum + (item.supply_price || 0), 0));
                    const total = doorSubtotal + hardwareSubtotal;
                    
                    document.getElementById('door-subtotal').textContent = doorSubtotal.toLocaleString() + '원';
                    document.getElementById('hardware-subtotal').textContent = hardwareSubtotal.toLocaleString() + '원';
                    document.getElementById('added-items-total').textContent = total.toLocaleString() + '원';
            } catch (error) {
                console.error('추가된 품목 목록 조회 실패:', error);
            }
        }
        
        // 계산기 초기화 (견적 품목도 삭제)
        async function resetCalculator() {
            if (!confirm('모든 입력 내용과 추가된 견적 품목이 삭제됩니다.\n초기화 하시겠습니까?')) {
                return;
            }
            
            try {
                // 임시 품목 모두 삭제 (quotation_id가 NULL인 품목)
                const response = await axios.get('api/quotation/items');
                if (response.data.success && response.data.items.length > 0) {
                    const deletePromises = response.data.items.map(item => 
                        axios.delete(`/api/quotation/items/${item.id}`)
                    );
                    await Promise.all(deletePromises);
                }
                
                // 페이지 리로드
                location.reload();
            } catch (error) {
                console.error('초기화 실패:', error);
                alert('초기화 중 오류가 발생했습니다.');
            }
        }
        
        // 견적 품목 개수 업데이트
        function updateQuotationItemsBadge() {
            try {
                // 로컬스토리지에서 품목 개수 조회 (app.js의 함수 사용)
                const count = getLocalQuotationCount();
                const badge = document.getElementById('quotationItemsBadge');
                if (badge) {
                    badge.textContent = count;
                }
                console.log('🔢 견적 품목 개수:', count);
            } catch (error) {
                console.error('견적 품목 개수 조회 실패:', error);
            }
        }
        
        // 견적 품목 관리 모달 열기
        async function openQuotationItemsModal() {
            document.getElementById('quotationItemsModal').classList.remove('hidden');
            await loadQuotationItems();
        }
        
        // window 객체에 명시적으로 추가 (app.js의 동적 HTML에서 사용)
        window.openQuotationItemsModal = openQuotationItemsModal;
        
        // 견적 품목 관리 모달 닫기
        function closeQuotationItemsModal() {
            document.getElementById('quotationItemsModal').classList.add('hidden');
            // currentQuotationId는 유지 (견적서 수정 모드에서 품목 추가 가능하도록)
            // 견적서 목록 모달을 열 때만 초기화
        }
        
        // 견적 품목 목록 로드 (로컬스토리지에서 읽기)
        function loadQuotationItems() {
            try {
                console.log('🚀 loadQuotationItems 시작 (로컬스토리지)');
                
                // 로컬스토리지에서 품목 조회 (app.js의 함수 사용)
                let items = getLocalQuotationItems();
                
                console.log('📡 로컬스토리지 품목:', items);
                
                // 품목을 문틀/문짝과 하드웨어로 분리
                console.log('🔍 전체 품목 수:', items.length);
                
                const doorItems = items.filter(item => {
                    const hasFrame = parseFloat(item.frame_price || 0) > 0;
                    const hasDoor = parseFloat(item.door_price || 0) > 0;
                    const hasPainting = parseFloat(item.frame_painting_price || 0) > 0 || parseFloat(item.door_painting_price || 0) > 0;
                    const isDoor = hasFrame || hasDoor || hasPainting;
                    console.log(`📋 [${item.fire_door_type}] 문틀/문짝? ${isDoor}`, {
                        frame: item.frame_price + ' → ' + parseFloat(item.frame_price || 0),
                        door: item.door_price + ' → ' + parseFloat(item.door_price || 0),
                        hardware: item.hardware_price + ' → ' + parseFloat(item.hardware_price || 0)
                    });
                    return isDoor;
                });
                
                const hardwareItems = items.filter(item => {
                    const hasFrame = parseFloat(item.frame_price || 0) > 0;
                    const hasDoor = parseFloat(item.door_price || 0) > 0;
                    const hasPainting = parseFloat(item.frame_painting_price || 0) > 0 || parseFloat(item.door_painting_price || 0) > 0;
                    const hasHardware = parseFloat(item.hardware_price || 0) > 0;
                    const isHardware = !hasFrame && !hasDoor && !hasPainting && hasHardware;
                    console.log(`🔧 [${item.fire_door_type}] 하드웨어? ${isHardware}`, {
                        frame: parseFloat(item.frame_price || 0),
                        door: parseFloat(item.door_price || 0),
                        painting: parseFloat(item.frame_painting_price || 0) + parseFloat(item.door_painting_price || 0),
                        hardware: parseFloat(item.hardware_price || 0)
                    });
                    return isHardware;
                });
                
                console.log('✅ 필터링 결과:', {doorItems: doorItems.length, hardwareItems: hardwareItems.length});
                
                // 문틀/문짝 섹션 렌더링
                const doorContainer = document.getElementById('modalDoorItemsList');
                document.getElementById('doorItemsCount').textContent = doorItems.length + '개';
                
                if (doorItems.length === 0) {
                    doorContainer.innerHTML = '<div class="text-center py-8 text-gray-400 text-sm border-x border-b rounded-b-xl">등록된 품목이 없습니다</div>';
                } else {
                    doorContainer.innerHTML = `
                        <div class="overflow-x-auto border-x border-b rounded-b-xl">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-blue-50">
                                        <th class="border p-2 text-xs">No</th>
                                        <th class="border p-2 text-xs">품목</th>
                                        <th class="border p-2 text-xs">규격</th>
                                        <th class="border p-2 text-xs">후렘두께</th>
                                        <th class="border p-2 text-xs">문틀단가</th>
                                        <th class="border p-2 text-xs">문짝단가</th>
                                        <th class="border p-2 text-xs">문틀도장</th>
                                        <th class="border p-2 text-xs">문짝도장</th>
                                        <th class="border p-2 text-xs">합계</th>
                                        <th class="border p-2 text-xs">수량</th>
                                        <th class="border p-2 text-xs">공급가액</th>
                                        <th class="border p-2 text-xs">특이사항</th>
                                        <th class="border p-2 text-xs">관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${doorItems.map((item, index) => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="border p-2 text-xs text-center">${index + 1}</td>
                                            <td class="border p-2 text-xs text-center">${item.fire_door_type}</td>
                                            <td class="border p-2 text-xs text-center">${item.frame_width}×${item.frame_height}</td>
                                            <td class="border p-2 text-xs text-center">${item.frame_thickness_info}</td>
                                            <td class="border p-2 text-xs text-right">${Math.floor(item.frame_price || 0).toLocaleString()}</td>
                                            <td class="border p-2 text-xs text-right">${Math.floor(item.door_price || 0).toLocaleString()}</td>
                                            <td class="border p-2 text-xs text-right">${Math.floor(item.frame_painting_price || 0).toLocaleString()}</td>
                                            <td class="border p-2 text-xs text-right">${Math.floor(item.door_painting_price || 0).toLocaleString()}</td>
                                            <td class="border p-2 text-xs text-right font-bold">${Math.floor(item.total_price || 0).toLocaleString()}</td>
                                            <td class="border p-2 text-xs text-center">
                                                <input type="number" value="${item.quantity}" min="1" 
                                                       onchange="updateItemQuantity('${item.id}', this.value)"
                                                       class="w-16 border rounded px-2 py-1 text-center">
                                            </td>
                                            <td class="border p-2 text-xs text-right font-bold text-indigo-600">${Math.floor(item.supply_price || 0).toLocaleString()}</td>
                                            <td class="border p-2 text-xs max-w-xs truncate" title="${escapeHtml(item.notes || '')}">${escapeHtml(item.notes || '')}</td>
                                            <td class="border p-2 text-xs text-center">
                                                <button onclick="editQuotationItem('${item.id}')" 
                                                        class="px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded mr-1">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteQuotationItem('${item.id}')" 
                                                        class="px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                // 하드웨어 섹션 렌더링
                const hardwareContainer = document.getElementById('modalHardwareItemsList');
                document.getElementById('hardwareItemsCount').textContent = hardwareItems.length + '개';
                
                if (hardwareItems.length === 0) {
                    hardwareContainer.innerHTML = '<div class="text-center py-8 text-gray-400 text-sm border-x border-b rounded-b-xl">등록된 품목이 없습니다</div>';
                } else {
                    hardwareContainer.innerHTML = `
                        <div class="overflow-x-auto border-x border-b rounded-b-xl">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-yellow-50">
                                        <th class="border p-2 text-xs">No</th>
                                        <th class="border p-2 text-xs">품목</th>
                                        <th class="border p-2 text-xs">수량</th>
                                        <th class="border p-2 text-xs">단가</th>
                                        <th class="border p-2 text-xs">공급가액</th>
                                        <th class="border p-2 text-xs">특이사항</th>
                                        <th class="border p-2 text-xs">관리</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${hardwareItems.map((item, index) => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="border p-2 text-xs text-center">${index + 1}</td>
                                            <td class="border p-2 text-xs text-center">${item.fire_door_type}</td>
                                            <td class="border p-2 text-xs text-center">
                                                <input type="number" value="${item.quantity}" min="1" 
                                                       onchange="updateItemQuantity('${item.id}', this.value)"
                                                       class="w-16 border rounded px-2 py-1 text-center">
                                            </td>
                                                <td class="border p-2 text-xs text-right">${Math.floor(item.hardware_price || 0).toLocaleString()}</td>
                                                <td class="border p-2 text-xs text-right font-bold text-indigo-600">${Math.floor(item.supply_price || 0).toLocaleString()}</td>
                                                <td class="border p-2 text-xs max-w-xs truncate" title="${escapeHtml(item.notes || '')}">${escapeHtml(item.notes || '')}</td>
                                                <td class="border p-2 text-xs text-center">
                                                    <button onclick="editHardwareItem(${item.id})" 
                                                            class="px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded mr-1">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button onclick="deleteQuotationItem(${item.id})" 
                                                            class="px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    
                    // 총 합계 업데이트
                    const doorTotal = doorItems.reduce((sum, item) => sum + parseInt(item.supply_price || 0), 0);
                    const hardwareTotal = hardwareItems.reduce((sum, item) => sum + parseInt(item.supply_price || 0), 0);
                    const totalAmount = doorTotal + hardwareTotal;
                    const count = doorItems.length + hardwareItems.length;
                    
                    document.getElementById('quotationItemsCount').textContent = count;
                    document.getElementById('quotationTotalAmount').textContent = totalAmount.toLocaleString();
                }
            } catch (error) {
                console.error('견적 품목 로드 실패:', error);
                alert('견적 품목을 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 견적 품목 수량 수정
        function updateItemQuantity(id, quantity) {
            try {
                // 로컬스토리지에서 품목 수정 (app.js의 함수 사용)
                const items = getLocalQuotationItems();
                const item = items.find(i => i.id == id);
                
                if (item) {
                    const qty = parseInt(quantity);
                    const supplyPrice = item.total_price * qty;
                    
                    const result = updateLocalQuotationItem(id, { 
                        quantity: qty,
                        supply_price: supplyPrice
                    });
                    
                    if (result) {
                        loadQuotationItems(); // 목록 새로고침
                        console.log(`✅ 수량 수정: ID ${id}, 수량 ${qty}, 공급가액 ${supplyPrice}`);
                    } else {
                        alert('오류: 수량 수정 실패');
                    }
                } else {
                    alert('오류: 품목을 찾을 수 없습니다.');
                }
            } catch (error) {
                console.error('수량 수정 실패:', error);
                alert('수량 수정 중 오류가 발생했습니다.');
            }
        }
        
        // 견적 품목 삭제
        function deleteQuotationItem(id) {
            if (!confirm('이 품목을 삭제하시겠습니까?')) {
                return;
            }
            
            try {
                // 로컬스토리지에서 품목 삭제 (app.js의 함수 사용)
                const result = removeLocalQuotationItem(id);
                
                if (result) {
                    loadQuotationItems(); // 목록 새로고침
                    updateQuotationItemsBadge(); // 뱃지 업데이트
                    updateAddedItemsList(); // 하단 품목 목록 업데이트
                    alert('품목이 삭제되었습니다.');
                } else {
                    alert('오류: 품목 삭제 실패');
                }
            } catch (error) {
                console.error('품목 삭제 실패:', error);
                alert('품목 삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 전체 삭제
        function clearAllQuotationItems() {
            if (!confirm('모든 견적 품목을 삭제하시겠습니까?')) {
                return;
            }
            
            try {
                // 로컬스토리지 전체 삭제 (app.js의 함수 사용)
                const result = clearLocalQuotation();
                
                if (result) {
                    loadQuotationItems(); // 목록 새로고침
                    updateQuotationItemsBadge(); // 뱃지 업데이트
                    updateAddedItemsList(); // 하단 품목 목록 업데이트
                    alert('모든 품목이 삭제되었습니다.');
                } else {
                    alert('오류: 전체 삭제 실패');
                }
            } catch (error) {
                console.error('전체 삭제 실패:', error);
                alert('전체 삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 견적 품목 수정 모달 열기 (로컬스토리지에서 읽기)
        function editQuotationItem(id) {
            try {
                // 로컬스토리지에서 품목 조회 (app.js의 함수 사용)
                const items = getLocalQuotationItems();
                const item = items.find(i => i.id == id);
                
                if (!item) {
                    console.error('❌ 품목을 찾을 수 없습니다. ID:', id);
                    alert('품목을 찾을 수 없습니다.');
                    return;
                }
                
                console.log('✅ 품목 찾음:', item);
                
                // 모달 필드에 데이터 채우기
                document.getElementById('edit_item_id').value = item.id;
                document.getElementById('edit_fire_door_type').value = item.fire_door_type || '';
                document.getElementById('edit_quantity').value = item.quantity || 1;
                document.getElementById('edit_frame_width').value = item.frame_width || '';
                document.getElementById('edit_frame_height').value = item.frame_height || '';
                document.getElementById('edit_frame_thickness_info').value = item.frame_thickness_info || '';
                
                // 가격 필드는 천단위 쉼표 포맷 적용
                const framePrice = parseInt(item.frame_price) || 0;
                const doorPrice = parseInt(item.door_price) || 0;
                const hardwarePrice = parseInt(item.hardware_price) || 0;
                const framePaintingPrice = parseInt(item.frame_painting_price) || 0;
                const doorPaintingPrice = parseInt(item.door_painting_price) || 0;
                
                document.getElementById('edit_frame_price').value = framePrice.toLocaleString();
                document.getElementById('edit_door_price').value = doorPrice.toLocaleString();
                document.getElementById('edit_hardware_price').value = hardwarePrice.toLocaleString();
                document.getElementById('edit_frame_painting_price').value = framePaintingPrice.toLocaleString();
                document.getElementById('edit_door_painting_price').value = doorPaintingPrice.toLocaleString();
                document.getElementById('edit_notes').value = item.notes || '';
                
                // 모달 열기
                document.getElementById('editQuotationItemModal').classList.remove('hidden');
            } catch (error) {
                console.error('❌ 품목 로드 실패:', error);
                alert('품목 정보를 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 하드웨어 품목 수정 (간단한 프롬프트 방식)
        async function editHardwareItem(id) {
            try {
                const response = await axios.get('api/quotation/items');
                const items = response.data.items || [];
                const item = items.find(i => i.id === id);
                
                if (!item) {
                    alert('품목을 찾을 수 없습니다.');
                    return;
                }
                
                // 수량 수정
                const newQuantity = prompt('수량을 입력하세요:', item.quantity);
                if (newQuantity === null) return;
                
                const quantity = parseInt(newQuantity);
                if (isNaN(quantity) || quantity < 1) {
                    alert('올바른 수량을 입력하세요.');
                    return;
                }
                
                // 단가 (hardware_price) 수정
                const newPrice = prompt('단가를 입력하세요:', item.hardware_price);
                if (newPrice === null) return;
                
                const hardwarePrice = parseInt(newPrice.replace(/,/g, ''));
                if (isNaN(hardwarePrice) || hardwarePrice < 0) {
                    alert('올바른 금액을 입력하세요.');
                    return;
                }
                
                // 특이사항 수정
                const newNotes = prompt('특이사항을 입력하세요:', item.notes || '');
                
                // 업데이트 데이터
                const updateData = {
                    fire_door_type: item.fire_door_type,
                    quantity: quantity,
                    hardware_price: hardwarePrice,
                    total_price: hardwarePrice * quantity,
                    supply_price: hardwarePrice * quantity,
                    notes: newNotes,
                    // 하드웨어 전용 품목이므로 나머지는 0
                    frame_width: '',
                    frame_height: '',
                    frame_thickness_info: '',
                    frame_price: 0,
                    door_price: 0,
                    frame_painting_price: 0,
                    door_painting_price: 0
                };
                
                const updateResponse = await axios.put(`/api/quotation/items/${id}`, updateData);
                
                if (updateResponse.data.success) {
                    alert('✅ 하드웨어 품목이 수정되었습니다.');
                    await loadQuotationItems();
                    await updateAddedItemsList();
                } else {
                    alert('❌ 오류: ' + updateResponse.data.message);
                }
            } catch (error) {
                console.error('❌ 하드웨어 품목 수정 실패:', error);
                alert('하드웨어 품목을 수정하는 중 오류가 발생했습니다.');
            }
        }
        
        // 가격 입력 필드 포맷팅 (천단위 쉼표, 소숫점 제거)
        function formatPriceInput(input) {
            // 숫자만 추출
            let value = input.value.replace(/[^0-9]/g, '');
            
            // 빈 값이면 그대로 반환
            if (value === '') {
                input.value = '';
                return;
            }
            
            // 천단위 쉼표 추가
            input.value = parseInt(value).toLocaleString();
        }
        
        // 견적 품목 수정 모달 닫기
        function closeEditQuotationItemModal() {
            document.getElementById('editQuotationItemModal').classList.add('hidden');
        }
        
        // 견적 품목 저장
        function saveQuotationItem() {
            const id = document.getElementById('edit_item_id').value;
            const fireDoorType = document.getElementById('edit_fire_door_type').value;
            const quantity = parseInt(document.getElementById('edit_quantity').value);
            const frameWidth = document.getElementById('edit_frame_width').value;
            const frameHeight = document.getElementById('edit_frame_height').value;
            const frameThicknessInfo = document.getElementById('edit_frame_thickness_info').value;
            
            // 쉼표 제거 후 숫자로 변환
            const framePrice = parseInt(document.getElementById('edit_frame_price').value.replace(/,/g, '')) || 0;
            const doorPrice = parseInt(document.getElementById('edit_door_price').value.replace(/,/g, '')) || 0;
            const hardwarePrice = parseInt(document.getElementById('edit_hardware_price').value.replace(/,/g, '')) || 0;
            const framePaintingPrice = parseInt(document.getElementById('edit_frame_painting_price').value.replace(/,/g, '')) || 0;
            const doorPaintingPrice = parseInt(document.getElementById('edit_door_painting_price').value.replace(/,/g, '')) || 0;
            const notes = document.getElementById('edit_notes').value;
            
            // 합계 계산
            const totalPrice = framePrice + doorPrice + hardwarePrice + framePaintingPrice + doorPaintingPrice;
            const supplyPrice = totalPrice * quantity;
            
            try {
                // 로컬스토리지에서 품목 수정 (app.js의 함수 사용)
                const result = updateLocalQuotationItem(id, {
                    fire_door_type: fireDoorType,
                    quantity: quantity,
                    frame_width: frameWidth,
                    frame_height: frameHeight,
                    frame_thickness_info: frameThicknessInfo,
                    frame_price: framePrice,
                    door_price: doorPrice,
                    hardware_price: hardwarePrice,
                    frame_painting_price: framePaintingPrice,
                    door_painting_price: doorPaintingPrice,
                    total_price: totalPrice,
                    supply_price: supplyPrice,
                    notes: notes
                });
                
                if (result) {
                    alert('품목이 수정되었습니다.');
                    closeEditQuotationItemModal();
                    loadQuotationItems(); // 목록 새로고침
                    updateAddedItemsList(); // 하단 품목 목록 업데이트
                } else {
                    alert('오류: 품목 수정 실패');
                }
            } catch (error) {
                console.error('품목 수정 실패:', error);
                alert('품목 수정 중 오류가 발생했습니다: ' + error.message);
            }
        }
        
        // 견적 조건 편집 (견적서 생성 모달 열기)
        function editQuotationInfo() {
            // 수정 모드인지 확인
            const editIdInput = document.getElementById('edit_quotation_id');
            const isEditMode = editIdInput && editIdInput.value;
            
            if (isEditMode) {
                // 수정 모드 UI 표시
                document.getElementById('quotationModalTitle').textContent = '견적서 수정';
                const submitBtn = document.getElementById('quotationSubmitBtn');
                submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>저장';
                submitBtn.className = 'px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition';
            } else {
                // 생성 모드 UI 표시
                document.getElementById('quotationModalTitle').textContent = '견적서 생성';
                const submitBtn = document.getElementById('quotationSubmitBtn');
                submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>견적서 생성';
                submitBtn.className = 'px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition';
            }
            
            // 견적 품목 관리 모달을 닫지 않고 견적서 생성 모달 열기
            document.getElementById('createQuotationModal').classList.remove('hidden');
        }
        
        // 견적서 생성 모달 열기
        function openCreateQuotationModal() {
            // 수정 모드 초기화 (생성 모드로 전환)
            const editIdInput = document.getElementById('edit_quotation_id');
            if (editIdInput) {
                editIdInput.value = '';
            }
            // 모달 타이틀을 생성으로 변경
            document.querySelector('#createQuotationModal h2').textContent = '견적서 생성';
            
            document.getElementById('createQuotationModal').classList.remove('hidden');
        }
        
        // 견적서 생성 모달 닫기
        function closeCreateQuotationModal() {
            document.getElementById('createQuotationModal').classList.add('hidden');
        }
        
        // 견적서 생성
        async function createQuotation() {
            const title = document.getElementById('quotation_title').value;
            const customerName = document.getElementById('quotation_customer_name').value;
            const siteName = document.getElementById('quotation_site_name').value;
            const customerPhone = document.getElementById('quotation_customer_phone').value;
            const customerAddress = document.getElementById('quotation_customer_address').value;
            const conditions = document.getElementById('quotation_conditions').value;
            const account = document.getElementById('quotation_account').value;
            const notes = document.getElementById('quotation_notes').value;
            const manager = document.getElementById('quotation_manager').value;
            
            // 수정 모드인지 확인
            const editIdInput = document.getElementById('edit_quotation_id');
            const isEditMode = editIdInput && editIdInput.value;
            
            console.log('📝 견적서 생성/수정 시작');
            console.log('📝 editIdInput:', editIdInput);
            console.log('📝 editIdInput.value:', editIdInput ? editIdInput.value : 'null');
            console.log('📝 isEditMode:', isEditMode);
            console.log('📝 currentQuotationId:', currentQuotationId);
            
            try {
                let response;
                if (isEditMode) {
                    // 수정 모드
                    console.log(`✏️ 수정 모드: 견적서 ID ${editIdInput.value} 업데이트`);
                    response = await axios.put(`/api/quotations/${editIdInput.value}`, {
                        title: title,
                        customer_name: customerName,
                        site_name: siteName,
                        customer_phone: customerPhone,
                        customer_address: customerAddress,
                        conditions: conditions,
                        account_info: account,
                        notes: notes,
                        manager: manager
                    });
                } else {
                    // 생성 모드
                    console.log('➕ 생성 모드: 새 견적서 생성');
                    response = await axios.post('api/quotation/create', {
                        title: title,
                        customer_name: customerName,
                        site_name: siteName,
                        customer_phone: customerPhone,
                        customer_address: customerAddress,
                        conditions: conditions,
                        account_info: account,
                        notes: notes,
                        manager: manager
                    });
                }
                
                if (response.data.success) {
                    const quotation = response.data.quotation;
                    if (isEditMode) {
                        alert(`견적서가 수정되었습니다.\n견적서 번호: ${quotation.quotation_no}`);
                        // 수정 모드 해제
                        editIdInput.value = '';
                        currentQuotationId = null;
                        // UI 리셋: 제목과 버튼을 생성 모드로 되돌림
                        document.getElementById('quotationModalTitle').textContent = '견적서 생성';
                        const submitBtn = document.getElementById('quotationSubmitBtn');
                        submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>견적서 생성';
                        submitBtn.className = 'px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition';
                    } else {
                        alert(`견적서가 생성되었습니다.\n견적서 번호: ${quotation.quotation_no}\n총액: ${quotation.totalAmount.toLocaleString()}원`);
                    }
                    
                    // 모달 닫기
                    closeCreateQuotationModal();
                    closeQuotationItemsModal();
                    
                    // 뱃지 업데이트
                    await updateQuotationItemsBadge();
                    
                    // 폼 초기화 (기본값 유지)
                    document.getElementById('quotation_title').value = '방화문 견적서';
                    document.getElementById('quotation_customer_name').value = '';
                    document.getElementById('quotation_site_name').value = '';
                    document.getElementById('quotation_customer_phone').value = '';
                    document.getElementById('quotation_customer_address').value = '';
                    // 견적조건, 비고, 계좌번호, 담당자는 기본값 유지
                    document.getElementById('quotation_conditions').value = '*분체도장: 블랙 또는 특수색상은 추가금이 있습니다.\n*일반 피봇힌지 / 일반 방화문손잡이타공 / 도어40T\n*하드웨어 별도 / 실커버 별도 / 몰탈사춤 별도 / 운임비 별도';
                    document.getElementById('quotation_notes').value = '계약금 30%입금 후 제작 가능합니다.\n계약금 미입금시 주문접수는 안되오니 참고 부탁드립니다.\n후레임 출고 시 30%, 도어 출고시 잔금 완불 후 출고되오니 참고 부탁드립니다.';
                    document.getElementById('quotation_account').value = '입금계좌: 기업은행 361-096546-04-019 (주)정일방화문';
                    document.getElementById('quotation_manager').value = '손효은';
                    document.getElementById('quotation_account').value = '입금계좌: 기업은행 361-096546-04-019 (주)정일방화문';
                } else {
                    alert('오류: ' + response.data.message);
                }
            } catch (error) {
                console.error('견적서 생성 실패:', error);
                alert('견적서 생성 중 오류가 발생했습니다: ' + (error.response?.data?.message || error.message));
            }
        }
        
        // ==================== 견적서 목록 함수 ====================
        
        // 견적서 목록 모달 열기
        async function openQuotationListModal() {
            // 견적서 목록 모달을 열 때 currentQuotationId 초기화 (전체 품목 표시 모드)
            currentQuotationId = null;
            console.log('📋 견적서 목록 모달 열림 - currentQuotationId 초기화');
            
            document.getElementById('quotationListModal').classList.remove('hidden');
            await loadQuotationList();
        }
        
        // 견적서 목록 모달 닫기
        function closeQuotationListModal() {
            document.getElementById('quotationListModal').classList.add('hidden');
        }
        
        // 견적서 목록 로드
        async function loadQuotationList() {
            try {
                const response = await axios.get('api/quotations');
                
                if (response.data.success) {
                    const quotations = response.data.quotations;
                    const container = document.getElementById('quotationList');
                    
                    if (quotations.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-12 text-gray-500">
                                <i class="fas fa-folder-open text-5xl mb-4"></i>
                                <p class="text-lg">생성된 견적서가 없습니다.</p>
                                <p class="text-sm mt-2">견적 품목을 추가한 후 견적서를 생성하세요.</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = `
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse">
                                    <thead>
                                        <tr class="bg-indigo-50">
                                            <th class="border p-3 text-sm font-bold">No</th>
                                            <th class="border p-3 text-sm font-bold">ID</th>
                                            <th class="border p-3 text-sm font-bold">견적서번호</th>
                                            <th class="border p-3 text-sm font-bold">제목</th>
                                            <th class="border p-3 text-sm font-bold">고객명</th>
                                            <th class="border p-3 text-sm font-bold">연락처</th>
                                            <th class="border p-3 text-sm font-bold">총액</th>
                                            <th class="border p-3 text-sm font-bold">작성일</th>
                                            <th class="border p-3 text-sm font-bold">상태</th>
                                            <th class="border p-3 text-sm font-bold">관리</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${quotations.map((q, index) => `
                                            <tr class="hover:bg-gray-50">
                                                <td class="border p-3 text-sm text-center">${index + 1}</td>
                                                <td class="border p-3 text-sm text-center text-gray-500">${q.id}</td>
                                                <td class="border p-3 text-sm text-center font-semibold text-indigo-600">${q.quotation_no}</td>
                                                <td class="border p-3 text-sm">${escapeHtml(q.title || '')}</td>
                                                <td class="border p-3 text-sm text-center">${escapeHtml(q.customer_name || '')}</td>
                                                <td class="border p-3 text-sm text-center">${escapeHtml(q.customer_phone || '')}</td>
                                                <td class="border p-3 text-sm text-right font-bold text-green-600">${parseInt(q.total_amount).toLocaleString()}원</td>
                                                <td class="border p-3 text-sm text-center">${new Date(q.created_at).toLocaleDateString('ko-KR')}</td>
                                                <td class="border p-3 text-sm text-center">
                                                    <span class="px-2 py-1 text-xs rounded ${q.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                                        ${q.status === 'active' ? '활성' : '완료'}
                                                    </span>
                                                </td>
                                                <td class="border p-3 text-sm text-center">
                                                    <button onclick="viewQuotation(${q.id})" class="px-3 py-1 bg-indigo-500 hover:bg-indigo-600 text-white text-xs rounded mr-1">
                                                        <i class="fas fa-eye"></i> 보기
                                                    </button>
                                                    <button onclick="window.location.href='/edit-quotation.html?id=${q.id}'" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded mr-1">
                                                        <i class="fas fa-edit"></i> 수정
                                                    </button>
                                                    <button onclick="deleteQuotation(${q.id}, '${escapeHtml(q.quotation_no)}')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded">
                                                        <i class="fas fa-trash"></i> 삭제
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('견적서 목록 로드 실패:', error);
                alert('견적서 목록을 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 견적서 상세 보기
        async function viewQuotation(id) {
            try {
                const response = await axios.get(`/api/quotations/${id}`);
                
                if (response.data.success) {
                    const quotation = response.data.quotation;
                    const items = response.data.items;
                    
                    // 견적서 HTML 생성
                    const quotationHTML = generateQuotationHTML(quotation, items);
                    
                    // 새 창에서 열기
                    const newWindow = window.open('', '_blank', 'width=900,height=800');
                    newWindow.document.write(quotationHTML);
                    newWindow.document.close();
                }
            } catch (error) {
                console.error('견적서 조회 실패:', error);
                alert('견적서를 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 견적서 HTML 생성
        function generateQuotationHTML(quotation, items) {
            // 품목 분류
            const doorItems = items.filter(item => {
                const hasFrame = parseFloat(item.frame_price || 0) > 0;
                const hasDoor = parseFloat(item.door_price || 0) > 0;
                const hasPainting = parseFloat(item.frame_painting_price || 0) > 0 || parseFloat(item.door_painting_price || 0) > 0;
                return hasFrame || hasDoor || hasPainting;
            });
            
            const hardwareItems = items.filter(item => {
                const hasHardware = parseFloat(item.hardware_price || 0) > 0;
                const hasFrame = parseFloat(item.frame_price || 0) > 0;
                const hasDoor = parseFloat(item.door_price || 0) > 0;
                const hasPainting = parseFloat(item.frame_painting_price || 0) > 0 || parseFloat(item.door_painting_price || 0) > 0;
                return hasHardware && !hasFrame && !hasDoor && !hasPainting;
            });
            
            // 금액 계산 (분류된 품목 기준)
            const doorSubtotal = doorItems.reduce((sum, item) => sum + (parseInt(item.supply_price) || 0), 0);
            const hardwareSubtotal = hardwareItems.reduce((sum, item) => sum + (parseInt(item.supply_price) || 0), 0);
            const supplyAmount = doorSubtotal + hardwareSubtotal;
            const vatAmount = Math.round(supplyAmount * 0.1);
            const totalAmount = supplyAmount + vatAmount;
            
            // 날짜 포맷
            const today = new Date();
            const formattedDate = `${today.getFullYear()}. ${String(today.getMonth() + 1).padStart(2, '0')}. ${String(today.getDate()).padStart(2, '0')}`;
            
            return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>견적서 - ${quotation.quotation_no}</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --corporate-blue: #003d82;
            --border-color: #000;
            --light-gray: #f2f2f2;
        }
        
        @media print {
            @page { margin: 15mm; size: A4; }
            body { margin: 0; padding: 20px 40px; }
            
            /* 모든 액션 버튼 숨기기 */
            .print-btn { display: none !important; }
            .action-buttons { display: none !important; }
            .action-btn { display: none !important; }
            
            /* fixed 요소들도 숨기기 */
            *[style*="position: fixed"] { display: none !important; }
        }
        
        body {
            max-width: 880px;
            margin: 0 auto;
            padding: 40px 60px;
            background-color: white;
            color: #000;
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            line-height: 1.4;
            font-size: 10pt;
            box-sizing: border-box;
        }
        
        /* 인쇄 버튼 */
        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .print-btn:hover {
            background: #059669;
        }
        
        /* 액션 버튼 그룹 */
        .action-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        
        .action-btn {
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .action-btn.pdf {
            background: #3b82f6;
        }
        
        .action-btn.email {
            background: #8b5cf6;
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .print-btn:hover {
            background: #059669;
        }
        
        /* 헤더 레이아웃 */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 20px;
            border-bottom: 3px solid var(--corporate-blue);
            padding-bottom: 10px;
        }
        
        .logo-area {
            font-size: 18pt;
            font-weight: 900;
            color: var(--corporate-blue);
            letter-spacing: -1px;
        }
        
        .title-area {
            text-align: center;
            flex-grow: 1;
        }
        
        .title-area h1 {
            margin: 0;
            font-size: 26pt;
            font-weight: 700;
            letter-spacing: 15px;
            color: #000;
            margin-left: 15px;
        }
        
        .doc-info {
            text-align: right;
            font-size: 9pt;
            color: #333;
        }
        
        /* 정보 섹션 */
        .info-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }
        
        .client-box {
            width: 40%;
            border: 1px solid #000;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .client-name {
            font-size: 14pt;
            font-weight: 700;
            text-decoration: underline;
            margin-right: 5px;
        }
        
        .supplier-box {
            width: 58%;
        }
        
        /* 공급자 테이블 */
        .supplier-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9pt;
        }
        
        .supplier-table th,
        .supplier-table td {
            border: 1px solid #000;
            padding: 4px 8px;
            white-space: nowrap;
        }
        
        .supplier-table th {
            background-color: var(--light-gray);
            text-align: center;
            width: 15%;
            font-weight: 500;
        }
        
        .seal-area {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 45px;
            vertical-align: middle;
            text-align: center;
            margin-left: 5px;
        }
        
        .seal-area img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* 요약 박스 */
        .summary-box {
            border: 2px solid #000;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .summary-item {
            text-align: center;
            flex: 1;
            border-right: 1px solid #ddd;
        }
        
        .summary-item:last-child {
            border-right: none;
        }
        
        .summary-label {
            display: block;
            font-size: 10pt;
            color: #666;
            margin-bottom: 5px;
        }
        
        .summary-value {
            display: block;
            font-size: 12pt;
            font-weight: 700;
        }
        
        .total-amount-display {
            font-size: 16pt;
            color: var(--corporate-blue);
        }
        
        /* 품목 테이블 */
        .quote-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 9pt;
        }
        
        .quote-table th {
            background-color: var(--corporate-blue);
            color: white;
            padding: 8px 5px;
            border: 1px solid #000;
            font-weight: 500;
            text-align: center;
        }
        
        .quote-table td {
            border: 1px solid #000;
            padding: 6px 8px;
            vertical-align: middle;
        }
        
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        
        /* 조건 섹션 */
        .terms-section {
            border-top: 2px solid #000;
            padding-top: 15px;
            font-size: 9pt;
        }
        
        .terms-section h3 {
            font-size: 11pt;
            margin: 0 0 10px 0;
            color: var(--corporate-blue);
            font-weight: 700;
        }
        
        .terms-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .terms-list li {
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }
        
        .terms-list li::before {
            content: '■';
            color: var(--corporate-blue);
            position: absolute;
            left: 0;
            font-size: 8pt;
            top: 2px;
        }
    </style>
</head>
<body>
    <div class="action-buttons">
        <button class="action-btn pdf" onclick="window.print()">📄 PDF 저장</button>
        <button class="action-btn" onclick="window.print()">🖨️ 인쇄하기</button>
    </div>
    
    <!-- 헤더 -->
    <div class="header-top">
        <div class="logo-area">
            정일방화문
        </div>
        <div class="title-area">
            <h1>견 적 서</h1>
        </div>
        <div class="doc-info">
            <div>견적번호 : ${quotation.quotation_no}</div>
            <div>견적일자 : ${formattedDate}</div>
            <div>페이지 : 1 / 1</div>
        </div>
    </div>
    
    <!-- 정보 섹션 -->
    <div class="info-section">
        <!-- 고객 정보 -->
        <div class="client-box">
            <div style="margin-bottom: 20px">
                <span class="client-name">${quotation.customer_name || '고객명'}</span>
                <span style="font-size: 12pt">귀하</span>
            </div>
            ${quotation.site_name ? `<div style="font-size: 10pt; margin-bottom: 10px;"><strong>현장명:</strong> ${quotation.site_name}</div>` : ''}
            <div style="font-size: 9pt; line-height: 1.6">
                <div>아래와 같이 견적을 제출합니다.</div>
                <div>문의사항이 있으시면 언제든지 연락 바랍니다.</div>
            </div>
        </div>
        
        <!-- 공급자 정보 -->
        <div class="supplier-box">
            <table class="supplier-table">
                <tr>
                    <th rowspan="4">공<br>급<br>자</th>
                    <th>등록번호</th>
                    <td colspan="3">613-81-81550</td>
                </tr>
                <tr>
                    <th>상 호</th>
                    <td>(주)정일방화문</td>
                    <th>대 표</th>
                    <td>최일순 <span class='seal-area'><img src='/static/seal.png' alt='직인'></span></td>
                </tr>
                <tr>
                    <th>주 소</th>
                    <td colspan="3">충남 천안시 서북구 상고1길 23-1(신당동)</td>
                </tr>
                <tr>
                    <th>업 태</th>
                    <td>제조</td>
                    <th>종 목</th>
                    <td>방화문</td>
                </tr>
                <tr>
                    <th>담당자</th>
                    <td colspan="4">${quotation.manager || '손효은'} (Tel: 041-568-9808 / Fax: 041-568-1808)</td>
                </tr>
            </table>
        </div>
    </div>
    
    <!-- 요약 박스 -->
    <div class="summary-box">
        <div class="summary-item">
            <span class="summary-label">공급가액 합계</span>
            <span class="summary-value">₩${supplyAmount.toLocaleString()}</span>
        </div>
        <div class="summary-item">
            <span class="summary-label">부가세 합계</span>
            <span class="summary-value">₩${vatAmount.toLocaleString()}</span>
        </div>
        <div class="summary-item" style="flex: 1.5">
            <span class="summary-label">총 합계금액 (VAT포함)</span>
            <span class="summary-value total-amount-display">₩${totalAmount.toLocaleString()}</span>
        </div>
    </div>
    
    <!-- 품목 테이블 - 문틀/문짝/도장비 섹션 -->
    ${doorItems.length > 0 ? `
    <table class="quote-table">
        <thead>
            <tr>
                <th style="width: 5%;">NO</th>
                <th style="width: 15%;">품 명</th>
                <th style="width: 10%;">규 격</th>
                <th style="width: 6%;">수 량</th>
                <th style="width: 10%;">문 틀</th>
                <th style="width: 10%;">문 짝</th>
                <th style="width: 8%;">문틀도장</th>
                <th style="width: 8%;">문짝도장</th>
                <th style="width: 10%;">공급가액</th>
                <th style="width: 18%;">특이사항</th>
            </tr>
        </thead>
        <tbody>
            ${doorItems.map(function(item, index) {
                const framePrice = parseInt(item.frame_price) || 0;
                const doorPrice = parseInt(item.door_price) || 0;
                const framePaintingPrice = parseInt(item.frame_painting_price) || 0;
                const doorPaintingPrice = parseInt(item.door_painting_price) || 0;
                const supplyPrice = parseInt(item.supply_price) || 0;
                const spec = (item.frame_width && item.frame_height) ? item.frame_width + '×' + item.frame_height : '-';
                
                return '<tr>' +
                    '<td class="text-center">' + (index + 1) + '</td>' +
                    '<td>' + item.fire_door_type + '</td>' +
                    '<td class="text-center">' + spec + '</td>' +
                    '<td class="text-center">' + item.quantity + '</td>' +
                    '<td class="text-right">' + framePrice.toLocaleString() + '</td>' +
                    '<td class="text-right">' + doorPrice.toLocaleString() + '</td>' +
                    '<td class="text-right">' + framePaintingPrice.toLocaleString() + '</td>' +
                    '<td class="text-right">' + doorPaintingPrice.toLocaleString() + '</td>' +
                    '<td class="text-right">' + supplyPrice.toLocaleString() + '</td>' +
                    '<td class="text-left" style="font-size: 8pt;">' + (item.notes || '') + '</td>' +
                    '</tr>';
            }).join('')}
            <!-- 문틀/문짝 소계 -->
            <tr style="background-color: #e3f2fd; font-weight: bold">
                <td colspan="8" class="text-center">문틀/문짝/도장비 소계</td>
                <td class="text-right">${doorSubtotal.toLocaleString()}</td>
                <td></td>
            </tr>
        </tbody>
    </table>
    ` : ''}
    
    <!-- 품목 테이블 - 하드웨어 섹션 -->
    ${hardwareItems.length > 0 ? `
    <table class="quote-table" style="margin-top: 15px;">
        <thead>
            <tr>
                <th style="width: 5%;">NO</th>
                <th style="width: 25%;">품 명</th>
                <th style="width: 12%;">규 격</th>
                <th style="width: 8%;">수 량</th>
                <th style="width: 15%;">단 가</th>
                <th style="width: 15%;">공급가액</th>
                <th style="width: 20%;">특이사항</th>
            </tr>
        </thead>
        <tbody>
            ${hardwareItems.map(function(item, index) {
                const hardwarePrice = parseInt(item.hardware_price) || 0;
                const supplyPrice = parseInt(item.supply_price) || 0;
                const spec = (item.frame_width && item.frame_height) ? item.frame_width + '×' + item.frame_height : '-';
                
                return '<tr>' +
                    '<td class="text-center">' + (index + 1) + '</td>' +
                    '<td>' + item.fire_door_type + '</td>' +
                    '<td class="text-center">' + spec + '</td>' +
                    '<td class="text-center">' + item.quantity + '</td>' +
                    '<td class="text-right">' + hardwarePrice.toLocaleString() + '</td>' +
                    '<td class="text-right">' + supplyPrice.toLocaleString() + '</td>' +
                    '<td class="text-left" style="font-size: 8pt;">' + (item.notes || '') + '</td>' +
                    '</tr>';
            }).join('')}
            <!-- 하드웨어 소계 -->
            <tr style="background-color: #fff3e0; font-weight: bold">
                <td colspan="5" class="text-center">하드웨어 소계</td>
                <td class="text-right">${hardwareSubtotal.toLocaleString()}</td>
                <td></td>
            </tr>
        </tbody>
    </table>
    ` : ''}
    
    <!-- 전체 합계 -->
    <table class="quote-table" style="margin-top: 15px;">
        <tbody>
            <tr style="background-color: #f5f5f5; font-weight: bold; font-size: 11pt;">
                <td class="text-center" style="width: 70%">합 계</td>
                <td class="text-right" style="width: 30%">${supplyAmount.toLocaleString()}</td>
            </tr>
        </tbody>
    </table>
    
    <!-- 견적 조건 및 특이사항 -->
    <div class="terms-section">
        <h3>※ 견적 조건 및 특이사항</h3>
        <ul class="terms-list">
            ${quotation.conditions ? `<li><strong>견적조건 :</strong> ${quotation.conditions}</li>` : ''}
            ${quotation.account_info ? `<li><strong>계좌번호 :</strong> ${quotation.account_info}</li>` : ''}
            ${quotation.customer_phone ? `<li><strong>연락처 :</strong> ${quotation.customer_phone}</li>` : ''}
            ${quotation.customer_address ? `<li><strong>주소 :</strong> ${quotation.customer_address}</li>` : ''}
            <li><strong>유효기간 :</strong> 견적일로부터 1개월간 유효</li>
            ${quotation.notes ? `<li><strong>기타사항 :</strong> ${quotation.notes}</li>` : ''}
        </ul>
    </div>
</body>
</html>
`;
        }
        
        // 숫자를 한글로 변환하는 함수
        function numberToKorean(number) {
            const units = ['', '만', '억', '조'];
            const smallUnits = ['', '십', '백', '천'];
            const digits = ['', '일', '이', '삼', '사', '오', '육', '칠', '팔', '구'];
            
            if (number === 0) return '영';
            
            let result = '';
            let unitIndex = 0;
            
            while (number > 0) {
                let part = number % 10000;
                if (part > 0) {
                    let partStr = '';
                    let smallUnitIndex = 0;
                    
                    while (part > 0) {
                        let digit = part % 10;
                        if (digit > 0) {
                            if (digit === 1 && smallUnitIndex > 0) {
                                partStr = smallUnits[smallUnitIndex] + partStr;
                            } else {
                                partStr = digits[digit] + smallUnits[smallUnitIndex] + partStr;
                            }
                        }
                        part = Math.floor(part / 10);
                        smallUnitIndex++;
                    }
                    
                    result = partStr + units[unitIndex] + result;
                }
                number = Math.floor(number / 10000);
                unitIndex++;
            }
            
            return result;
        }
        
        // 견적서 수정 (견적 품목 관리로 이동)
        async function editQuotation(id) {
            try {
                // 0. 전역 견적서 ID 설정
                currentQuotationId = id;
                
                // 1. 견적서 정보 먼저 로드
                const response = await axios.get(`/api/quotations/${id}`);
                
                if (!response.data.success) {
                    alert('견적서를 불러올 수 없습니다.');
                    return;
                }
                
                const quotation = response.data.quotation;
                
                // 2. 견적서 정보를 폼에 미리 채우기
                document.getElementById('quotation_title').value = quotation.title || '방화문 견적서';
                document.getElementById('quotation_customer_name').value = quotation.customer_name || '';
                document.getElementById('quotation_site_name').value = quotation.site_name || '';
                document.getElementById('quotation_customer_phone').value = quotation.customer_phone || '';
                document.getElementById('quotation_customer_address').value = quotation.customer_address || '';
                document.getElementById('quotation_conditions').value = quotation.conditions || '';
                document.getElementById('quotation_account').value = quotation.account_info || '';
                document.getElementById('quotation_notes').value = quotation.notes || '';
                document.getElementById('quotation_manager').value = quotation.manager || '손효은';
                
                // 3. 수정 모드 표시
                let editIdInput = document.getElementById('edit_quotation_id');
                if (!editIdInput) {
                    editIdInput = document.createElement('input');
                    editIdInput.type = 'hidden';
                    editIdInput.id = 'edit_quotation_id';
                    document.getElementById('createQuotationModal').querySelector('.p-6').appendChild(editIdInput);
                }
                editIdInput.value = id;
                
                // 4. 수정 모드 UI 표시
                document.getElementById('quotationModalTitle').textContent = '견적서 수정';
                const submitBtn = document.getElementById('quotationSubmitBtn');
                submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>저장';
                submitBtn.className = 'px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition';
                
                // 5. 견적서 목록 모달 닫기
                closeQuotationListModal();
                
                // 6. 견적 품목 관리 모달 열기 (로딩 완료 보장)
                await openQuotationItemsModal();
                
                console.log('✅ 견적서 수정 모드 준비 완료:', id);
            } catch (error) {
                console.error('견적서 로드 실패:', error);
                alert('견적서를 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 견적서 삭제
        async function deleteQuotation(id, quotationNo) {
            if (!confirm(`견적서 [${quotationNo}]을(를) 삭제하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await axios.delete(`/api/quotations/${id}`);
                
                if (response.data.success) {
                    alert('견적서가 삭제되었습니다.');
                    await loadQuotationList();
                } else {
                    alert('오류: ' + response.data.message);
                }
            } catch (error) {
                console.error('견적서 삭제 실패:', error);
                alert('견적서 삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 페이지 로드 시 견적 품목 개수 업데이트
        document.addEventListener('DOMContentLoaded', function() {
            updateQuotationItemsBadge();
            updateAddedItemsList();
            loadUserInfo(); // 로그인 사용자 정보 로드
            
            // COLOR 제품번호 입력 이벤트 리스너 추가
            const colorProductNoInput = document.getElementById('colorProductNo');
            if (colorProductNoInput) {
                // blur 이벤트로 입력 완료 시 조회
                colorProductNoInput.addEventListener('blur', async function() {
                    const productNo = this.value.trim();
                    if (!productNo) return;
                    
                    await fetchColorProductInfo(productNo);
                });
                
                // Enter 키 입력 시에도 조회
                colorProductNoInput.addEventListener('keypress', async function(e) {
                    if (e.key === 'Enter') {
                        const productNo = this.value.trim();
                        if (!productNo) return;
                        
                        await fetchColorProductInfo(productNo);
                    }
                });
            }
        });
        
        // COLOR 제품 정보 조회 및 철판두께 자동 체크
        async function fetchColorProductInfo(productNo) {
            try {
                console.log(`🔍 COLOR 제품 조회 시작: ${productNo}`);
                
                const response = await fetch(`/api/colors/product/${encodeURIComponent(productNo)}`);
                const data = await response.json();
                
                if (data.success && data.product) {
                    const product = data.product;
                    console.log(`✅ COLOR 제품 조회 성공:`, product);
                    
                    // 제품 설명 표시
                    const descElement = document.getElementById('colorProductDetailDesc');
                    if (descElement) {
                        const descParts = [];
                        if (product.product_name) descParts.push(product.product_name);
                        if (product.product_description) descParts.push(product.product_description);
                        descElement.textContent = descParts.join(' - ');
                    }
                    
                    // 철판두께 자동 체크
                    if (product.steel_thickness) {
                        const thickness = parseFloat(product.steel_thickness);
                        console.log(`🔧 철판두께 설정: ${thickness}mm`);
                        
                        // 라디오 버튼 찾기 및 체크
                        const steelThicknessRadios = document.querySelectorAll('input[name="steelPlateThickness"]');
                        let matched = false;
                        
                        steelThicknessRadios.forEach(radio => {
                            // 값 비교 (0.6t, 0.8t 등)
                            const radioValue = parseFloat(radio.value); // "0.6t" → 0.6
                            
                            if (radioValue === thickness) {
                                radio.checked = true;
                                matched = true;
                                console.log(`✅ 철판두께 ${radio.value} 자동 선택됨`);
                            }
                        });
                        
                        if (!matched) {
                            console.warn(`⚠️ 철판두께 ${thickness}mm에 해당하는 라디오버튼을 찾을 수 없습니다.`);
                        }
                    }
                    
                    // 최대 규격 정보가 있으면 표시 (선택사항)
                    if (product.max_width || product.max_height) {
                        console.log(`📏 최대 규격: ${product.max_width || '∞'} × ${product.max_height || '∞'} mm`);
                    }
                } else {
                    console.warn(`⚠️ COLOR 제품을 찾을 수 없습니다: ${productNo}`);
                    // 사용자에게 알림 (선택사항)
                    // alert(`제품번호 "${productNo}"를 찾을 수 없습니다.`);
                }
            } catch (error) {
                console.error('❌ COLOR 제품 조회 실패:', error);
            }
        }
        
        // 로그인 사용자 정보 로드
        async function loadUserInfo() {
            try {
                const response = await fetch('api/auth/me');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('userName').textContent = data.user.name;
                    
                    // 관리자일 때만 사용자 관리 버튼 표시
                    if (data.user.role === 'admin') {
                        document.getElementById('settingsBtn').style.display = 'flex';
                        document.getElementById('userManagementBtn').style.display = 'flex';
                        document.getElementById('settingsBtn').style.display = 'flex';
                    }
                } else {
                    // 로그인되지 않은 경우 로그인 페이지로 리다이렉트
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('사용자 정보 로드 실패:', error);
                window.location.href = '/login.html';
            }
        }
        
        // 로그아웃
        async function logout() {
            try {
                await fetch('api/auth/logout', { method: 'POST' });
                window.location.href = '/login.html';
            } catch (error) {
                console.error('로그아웃 실패:', error);
                window.location.href = '/login.html';
            }
        }

        // FSD/인정제품 + 양개 선택 시 문짝종류와 철판두께 자동 설정
        function handleFireDoorTypeChange() {
            const fireDoorType = document.querySelector('input[name="fireDoorType"]:checked')?.value;
            const doorType = document.querySelector('input[name="doorType"]:checked')?.value;
            const doorMaterialRadios = document.querySelectorAll('input[name="doorMaterial"]');
            const doorThicknessRadios = document.querySelectorAll('input[name="doorThickness"]');
            
            // FSD 또는 인정제품 + 양개일 때만
            if ((fireDoorType === 'fsd' || fireDoorType === 'certified') && doorType === 'double') {
                console.log(`🔥 ${fireDoorType} + 양개 선택 - 문짝종류 EGI, 철판두께 1.0T 자동 설정`);
                
                // 문짝종류를 EGI만 선택 가능하게
                doorMaterialRadios.forEach(radio => {
                    if (radio.value === 'egi') {
                        radio.checked = true;
                        radio.disabled = false;
                        radio.closest('label').classList.remove('opacity-50', 'cursor-not-allowed');
                        radio.closest('label').classList.add('cursor-pointer');
                    } else {
                        radio.checked = false;
                        radio.disabled = true;
                        radio.closest('label').classList.add('opacity-50', 'cursor-not-allowed');
                        radio.closest('label').classList.remove('cursor-pointer');
                    }
                });
                
                // 철판두께를 1.0T로 자동 선택
                doorThicknessRadios.forEach(radio => {
                    if (radio.value === '1.0') {
                        radio.checked = true;
                    }
                });
                
            } else {
                // 다른 경우에는 모든 문짝종류 활성화
                doorMaterialRadios.forEach(radio => {
                    radio.disabled = false;
                    radio.closest('label').classList.remove('opacity-50', 'cursor-not-allowed');
                    radio.closest('label').classList.add('cursor-pointer');
                });
            }
        }
        
        // 방화문 타입 및 문짝 타입 변경 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', function() {
            const fireDoorTypeRadios = document.querySelectorAll('input[name="fireDoorType"]');
            const doorTypeRadios = document.querySelectorAll('input[name="doorType"]');
            
            // 방화문 타입 변경 이벤트
            fireDoorTypeRadios.forEach(radio => {
                radio.addEventListener('change', handleFireDoorTypeChange);
            });
            
            // 문짝 타입 변경 이벤트 (편개/양개)
            doorTypeRadios.forEach(radio => {
                radio.addEventListener('change', handleFireDoorTypeChange);
            });
            
            // 초기 실행
            handleFireDoorTypeChange();
        });
    </script>
    
    <!-- 견적 품목 관리 모달 -->
</body>
</html>
